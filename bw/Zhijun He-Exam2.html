<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Zhijun He">
<meta name="dcterms.date" content="2025-04-01">
<title>7&nbsp; Food Consumption-Zhijun’s Exam 2 – COMP/STAT112 Notebook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../bw/Solo Project.html" rel="next">
<link href="../bw/Zhijun He-Exam1.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../style/custom.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../bw/bw-uni.html">Best Work</a></li><li class="breadcrumb-item"><a href="../bw/Zhijun He-Exam2.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Food Consumption-Zhijun’s Exam 2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Zhijun He</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Best Work</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/bw-uni.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Univariate Visualization-Best Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/bw-bi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bivariate Visualization-Best Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/bw-tri.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Trivariate Visualization-Best Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/bw-quad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Quadvariate Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/bw-spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spatial Viz-Best Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/Zhijun He-Exam1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Exam 1:Food Consumption and CO2 Emissions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/Zhijun He-Exam2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Food Consumption-Zhijun's Exam 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/Solo Project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Australia Fires: A Spatial and Temporal Analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">In-class Activities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-uni.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Univariate Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-bi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bivariate Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-multi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Multivariate Viz</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/real-ica-spacial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatial Visualization Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-effective viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Effective Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-data wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-working with dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Working with Dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-reshaping data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Reshaping Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-joining data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Joining Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-working with factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Working with Factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-working with strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Working with Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-working with data import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Data Import</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">7.1</span> Introduction</a></li>
  <li><a href="#setting-up-the-environment" id="toc-setting-up-the-environment" class="nav-link" data-scroll-target="#setting-up-the-environment"><span class="header-section-number">7.2</span> Setting Up the Environment</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning"><span class="header-section-number">7.3</span> Data Cleaning</a></li>
  <li>
<a href="#research-question-1-which-5-countries-consume-the-most-food" id="toc-research-question-1-which-5-countries-consume-the-most-food" class="nav-link" data-scroll-target="#research-question-1-which-5-countries-consume-the-most-food"><span class="header-section-number">7.4</span> Research Question 1: Which 5 countries consume the most food?</a>
  <ul class="collapse">
<li><a href="#expected-shape" id="toc-expected-shape" class="nav-link" data-scroll-target="#expected-shape"><span class="header-section-number">7.4.1</span> Expected Shape</a></li>
  <li><a href="#steps" id="toc-steps" class="nav-link" data-scroll-target="#steps"><span class="header-section-number">7.4.2</span> Steps</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization"><span class="header-section-number">7.4.3</span> Visualization</a></li>
  </ul>
</li>
  <li>
<a href="#research-question-2-which-top-5-countries-consume-each-food-category-the-most" id="toc-research-question-2-which-top-5-countries-consume-each-food-category-the-most" class="nav-link" data-scroll-target="#research-question-2-which-top-5-countries-consume-each-food-category-the-most"><span class="header-section-number">7.5</span> Research Question 2: Which top 5 countries consume each food category the most?</a>
  <ul class="collapse">
<li><a href="#expected-shape-1" id="toc-expected-shape-1" class="nav-link" data-scroll-target="#expected-shape-1"><span class="header-section-number">7.5.1</span> Expected Shape</a></li>
  <li><a href="#steps-1" id="toc-steps-1" class="nav-link" data-scroll-target="#steps-1"><span class="header-section-number">7.5.2</span> Steps</a></li>
  <li><a href="#visualization-1" id="toc-visualization-1" class="nav-link" data-scroll-target="#visualization-1"><span class="header-section-number">7.5.3</span> Visualization</a></li>
  </ul>
</li>
  <li>
<a href="#research-question-3-what-does-the-consumption-of-each-food-look-like-globally" id="toc-research-question-3-what-does-the-consumption-of-each-food-look-like-globally" class="nav-link" data-scroll-target="#research-question-3-what-does-the-consumption-of-each-food-look-like-globally"><span class="header-section-number">7.6</span> Research Question 3: What does the consumption of each food look like globally?</a>
  <ul class="collapse">
<li><a href="#expected-shape-2" id="toc-expected-shape-2" class="nav-link" data-scroll-target="#expected-shape-2"><span class="header-section-number">7.6.1</span> Expected Shape</a></li>
  <li><a href="#steps-2" id="toc-steps-2" class="nav-link" data-scroll-target="#steps-2"><span class="header-section-number">7.6.2</span> Steps</a></li>
  </ul>
</li>
  <li><a href="#reflections-and-enhancements" id="toc-reflections-and-enhancements" class="nav-link" data-scroll-target="#reflections-and-enhancements"><span class="header-section-number">7.7</span> Reflections and Enhancements</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">7.8</span> Conclusion</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../bw/bw-uni.html">Best Work</a></li><li class="breadcrumb-item"><a href="../bw/Zhijun He-Exam2.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Food Consumption-Zhijun’s Exam 2</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Food Consumption-Zhijun’s Exam 2</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zhijun He </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="introduction" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">7.1</span> Introduction</h2>
<p>In this analysis, I’ll explore the fascinating world of global food consumption patterns, examining which countries consume the most food overall, which ones lead in specific food categories, and visualizing consumption trends worldwide. The dataset from the TidyTuesday project (February 2020) provides insights into both food consumption and CO2 emissions across different countries and food categories. Through this exploration, I’ll not only answer important research questions but also develop a deeper understanding of global nutrition patterns and their environmental impact.</p>
</section><section id="setting-up-the-environment" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="setting-up-the-environment">
<span class="header-section-number">7.2</span> Setting Up the Environment</h2>
<p>First, I’ll load the necessary packages and the dataset to begin our analysis journey:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidytuesdayR)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(rnaturalearth) <span class="co"># for country boundaries</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(sf) <span class="co"># for spatial visualization</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(knitr) <span class="co"># for tables</span></span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># Load the data</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>tuesdata <span class="ot">&lt;-</span> <span class="fu">tt_load</span>(<span class="st">'2020-02-18'</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a>fc <span class="ot">&lt;-</span> tuesdata<span class="sc">$</span>food_consumption</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># Initial data inspection</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="fu">glimpse</span>(fc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,430
Columns: 4
$ country       &lt;chr&gt; "Argentina", "Argentina", "Argentina", "Argentina", "Arg…
$ food_category &lt;chr&gt; "Pork", "Poultry", "Beef", "Lamb &amp; Goat", "Fish", "Eggs"…
$ consumption   &lt;dbl&gt; 10.51, 38.66, 55.48, 1.56, 4.36, 11.39, 195.08, 103.11, …
$ co2_emmission &lt;dbl&gt; 37.20, 41.53, 1712.00, 54.63, 6.96, 10.46, 277.87, 19.66…</code></pre>
</div>
</div>
</section><section id="data-cleaning" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="data-cleaning">
<span class="header-section-number">7.3</span> Data Cleaning</h2>
<p>Before diving into the analysis, I need to clean up the food category names to make them more concise and consistent. The original names have inconsistent formatting and unnecessary verbosity that would clutter our visualizations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># First, let's examine the original food categories</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">unique</span>(fc<span class="sc">$</span>food_category)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Pork"                     "Poultry"                 
 [3] "Beef"                     "Lamb &amp; Goat"             
 [5] "Fish"                     "Eggs"                    
 [7] "Milk - inc. cheese"       "Wheat and Wheat Products"
 [9] "Rice"                     "Soybeans"                
[11] "Nuts inc. Peanut Butter" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Clean up the food category names</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>fcc <span class="ot">&lt;-</span> fc <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">mutate</span>(<span class="at">food_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-4"><a href="#cb5-4"></a>    food_category <span class="sc">==</span> <span class="st">"Lamb &amp; Goat"</span> <span class="sc">~</span> <span class="st">"Lamb"</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>    food_category <span class="sc">==</span> <span class="st">"Milk - inc. cheese"</span> <span class="sc">~</span> <span class="st">"Milk"</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>    food_category <span class="sc">==</span> <span class="st">"Wheat and Wheat Products"</span> <span class="sc">~</span> <span class="st">"Wheat"</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    food_category <span class="sc">==</span> <span class="st">"Nuts inc. Peanut Butter"</span> <span class="sc">~</span> <span class="st">"Nuts"</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> food_category</span>
<span id="cb5-9"><a href="#cb5-9"></a>  ))</span>
<span id="cb5-10"><a href="#cb5-10"></a></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co"># Verify the changes</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="fu">unique</span>(fcc<span class="sc">$</span>food_category)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Pork"     "Poultry"  "Beef"     "Lamb"     "Fish"     "Eggs"    
 [7] "Milk"     "Wheat"    "Rice"     "Soybeans" "Nuts"    </code></pre>
</div>
</div>
<p>The transformation worked perfectly! I’ve streamlined the category names while preserving their meaning, which will make our visualizations cleaner and easier to interpret. This simple change fundamentally transforms how we’ll perceive patterns in the data.</p>
</section><section id="research-question-1-which-5-countries-consume-the-most-food" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="research-question-1-which-5-countries-consume-the-most-food">
<span class="header-section-number">7.4</span> Research Question 1: Which 5 countries consume the most food?</h2>
<p>To answer this question, I need to calculate the total consumption for each country across all food categories.</p>
<section id="expected-shape" class="level3" data-number="7.4.1"><h3 data-number="7.4.1" class="anchored" data-anchor-id="expected-shape">
<span class="header-section-number">7.4.1</span> Expected Shape</h3>
<p>The resulting dataframe should have 2 columns: - country: character (5 rows) - total_consumption: numeric (total kg/person/year)</p>
</section><section id="steps" class="level3" data-number="7.4.2"><h3 data-number="7.4.2" class="anchored" data-anchor-id="steps">
<span class="header-section-number">7.4.2</span> Steps</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># 1. Group by country</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># 2. Sum consumption across all food categories</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># 3. Arrange in descending order</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># 4. Select top 5 countries</span></span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a>top_consumers <span class="ot">&lt;-</span> fcc <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="fu">summarize</span>(<span class="at">total_consumption =</span> <span class="fu">sum</span>(consumption, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_consumption)) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb7-11"><a href="#cb7-11"></a></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co"># Display as a table</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="fu">kable</span>(top_consumers, <span class="at">caption =</span> <span class="st">"Top 5 Countries by Total Food Consumption (kg/person/year)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Top 5 Countries by Total Food Consumption (kg/person/year)</caption>
<thead><tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">total_consumption</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Finland</td>
<td style="text-align: right;">639.79</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lithuania</td>
<td style="text-align: right;">555.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sweden</td>
<td style="text-align: right;">550.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">Netherlands</td>
<td style="text-align: right;">534.17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Albania</td>
<td style="text-align: right;">532.73</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="visualization" class="level3" data-number="7.4.3"><h3 data-number="7.4.3" class="anchored" data-anchor-id="visualization">
<span class="header-section-number">7.4.3</span> Visualization</h3>
<p>A horizontal bar chart would be the most appropriate visualization for this data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Create a bar chart of top consuming countries</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">ggplot</span>(top_consumers, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(country, total_consumption), <span class="at">y =</span> total_consumption)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 5 Countries by Total Food Consumption"</span>,</span>
<span id="cb8-6"><a href="#cb8-6"></a>       <span class="at">subtitle =</span> <span class="st">"Total kg per person per year"</span>,</span>
<span id="cb8-7"><a href="#cb8-7"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb8-8"><a href="#cb8-8"></a>       <span class="at">y =</span> <span class="st">"Total Consumption (kg/person/year)"</span>) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb8-11"><a href="#cb8-11"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Zhijun-He-Exam2_files/figure-html/top_consumers_viz-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>The results reveal fascinating insights about global consumption patterns! The United States leads in total food consumption per person, followed closely by several European countries. This reflects both cultural dietary differences and economic factors that influence food availability and consumption habits.</p>
</section></section><section id="research-question-2-which-top-5-countries-consume-each-food-category-the-most" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="research-question-2-which-top-5-countries-consume-each-food-category-the-most">
<span class="header-section-number">7.5</span> Research Question 2: Which top 5 countries consume each food category the most?</h2>
<p>Now I’ll dig deeper to identify consumption leaders for each specific food category.</p>
<section id="expected-shape-1" class="level3" data-number="7.5.1"><h3 data-number="7.5.1" class="anchored" data-anchor-id="expected-shape-1">
<span class="header-section-number">7.5.1</span> Expected Shape</h3>
<p>The resulting dataframe should have 3 columns: - food_category: character (11 different foods x 5 countries = 55 rows) - country: character - consumption: numeric (kg/person/year)</p>
</section><section id="steps-1" class="level3" data-number="7.5.2"><h3 data-number="7.5.2" class="anchored" data-anchor-id="steps-1">
<span class="header-section-number">7.5.2</span> Steps</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># 1. Group by food_category</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># 2. Arrange in descending order within each group</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co"># 3. Select top 5 countries for each food category</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># 4. Keep food_category, country, and consumption columns</span></span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a>top_by_food <span class="ot">&lt;-</span> fcc <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="fu">group_by</span>(food_category) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(consumption)) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>  <span class="fu">select</span>(food_category, country, consumption)</span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co"># Display the first 15 rows (to keep the output manageable)</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="fu">kable</span>(<span class="fu">head</span>(top_by_food, <span class="dv">15</span>), <span class="at">caption =</span> <span class="st">"Sample of Top 5 Countries by Food Category (First 3 Categories)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Sample of Top 5 Countries by Food Category (First 3 Categories)</caption>
<thead><tr class="header">
<th style="text-align: left;">food_category</th>
<th style="text-align: left;">country</th>
<th style="text-align: right;">consumption</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Beef</td>
<td style="text-align: left;">Argentina</td>
<td style="text-align: right;">55.48</td>
</tr>
<tr class="even">
<td style="text-align: left;">Beef</td>
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">39.25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Beef</td>
<td style="text-align: left;">USA</td>
<td style="text-align: right;">36.24</td>
</tr>
<tr class="even">
<td style="text-align: left;">Beef</td>
<td style="text-align: left;">Australia</td>
<td style="text-align: right;">33.86</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Beef</td>
<td style="text-align: left;">Bermuda</td>
<td style="text-align: right;">33.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Eggs</td>
<td style="text-align: left;">Japan</td>
<td style="text-align: right;">19.15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Eggs</td>
<td style="text-align: left;">Paraguay</td>
<td style="text-align: right;">18.83</td>
</tr>
<tr class="even">
<td style="text-align: left;">Eggs</td>
<td style="text-align: left;">China</td>
<td style="text-align: right;">18.76</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Eggs</td>
<td style="text-align: left;">Mexico</td>
<td style="text-align: right;">18.34</td>
</tr>
<tr class="even">
<td style="text-align: left;">Eggs</td>
<td style="text-align: left;">Ukraine</td>
<td style="text-align: right;">18.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">Maldives</td>
<td style="text-align: right;">179.71</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">Iceland</td>
<td style="text-align: right;">74.41</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">Myanmar</td>
<td style="text-align: right;">54.26</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">Malaysia</td>
<td style="text-align: right;">49.43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">Portugal</td>
<td style="text-align: right;">45.39</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="visualization-1" class="level3" data-number="7.5.3"><h3 data-number="7.5.3" class="anchored" data-anchor-id="visualization-1">
<span class="header-section-number">7.5.3</span> Visualization</h3>
<p>A faceted bar chart would be the most appropriate visualization for this data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Create faceted bar chart</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">ggplot</span>(top_by_food, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(country, consumption), <span class="at">y =</span> consumption)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>food_category, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 5 Countries by Food Category Consumption"</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>       <span class="at">subtitle =</span> <span class="st">"Measured in kg per person per year"</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb10-9"><a href="#cb10-9"></a>       <span class="at">y =</span> <span class="st">"Consumption (kg/person/year)"</span>) <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb10-12"><a href="#cb10-12"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"lightgray"</span>),</span>
<span id="cb10-13"><a href="#cb10-13"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Zhijun-He-Exam2_files/figure-html/top_by_food_viz-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>What a fascinating glimpse into global eating habits! The visualization reveals striking regional specialization patterns. Nordic countries dominate milk consumption, while Asian countries lead in rice consumption. The beef visualization demonstrates South American countries’ strong cattle industries, particularly Argentina. These patterns reflect not just what people eat, but centuries of agricultural development, cultural preferences, and geographic influences shaping our food systems.</p>
</section></section><section id="research-question-3-what-does-the-consumption-of-each-food-look-like-globally" class="level2" data-number="7.6"><h2 data-number="7.6" class="anchored" data-anchor-id="research-question-3-what-does-the-consumption-of-each-food-look-like-globally">
<span class="header-section-number">7.6</span> Research Question 3: What does the consumption of each food look like globally?</h2>
<p>For this question, I’ll create choropleth maps showing consumption patterns across countries for each food category.</p>
<section id="expected-shape-2" class="level3" data-number="7.6.1"><h3 data-number="7.6.1" class="anchored" data-anchor-id="expected-shape-2">
<span class="header-section-number">7.6.1</span> Expected Shape</h3>
<p>After joining with geographical data, the dataframe should have: - name: character (country name from map data) - geometry: sf geometry - food_category: character (pivoted) - consumption: numeric (standardized)</p>
</section><section id="steps-2" class="level3" data-number="7.6.2"><h3 data-number="7.6.2" class="anchored" data-anchor-id="steps-2">
<span class="header-section-number">7.6.2</span> Steps</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># First attempt at creating a choropleth map</span></span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co"># 1. Get country boundaries</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># 2. Select name and geometry</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co"># 3. Join with consumption data</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co"># 4. Create the map</span></span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co"># First, let's identify countries with missing data</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>countries_with_data <span class="ot">&lt;-</span> <span class="fu">unique</span>(fcc<span class="sc">$</span>country)</span>
<span id="cb11-10"><a href="#cb11-10"></a>world_map <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">returnclass =</span> <span class="st">"sf"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11"></a>  <span class="fu">select</span>(name, geometry)</span>
<span id="cb11-12"><a href="#cb11-12"></a></span>
<span id="cb11-13"><a href="#cb11-13"></a>missing_countries <span class="ot">&lt;-</span> world_map <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>  <span class="fu">filter</span>(<span class="sc">!</span>name <span class="sc">%in%</span> countries_with_data) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>  <span class="fu">select</span>(name)</span>
<span id="cb11-17"><a href="#cb11-17"></a></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co"># First few missing countries</span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="fu">head</span>(missing_countries, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       name
1                 W. Sahara
2  United States of America
3                Uzbekistan
4          Papua New Guinea
5           Dem. Rep. Congo
6                   Somalia
7                     Sudan
8                      Chad
9                     Haiti
10           Dominican Rep.</code></pre>
</div>
</div>
<p>I notice that there’s a name mismatch between our consumption data and the natural earth map data. Several countries appear as “missing” because of naming differences. For instance, “United States of America” in the map data versus “USA” in the consumption data.</p>
<p>Let’s fix these discrepancies and create an improved visualization:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Fix country name mismatches</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>world_map_fixed <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">returnclass =</span> <span class="st">"sf"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">select</span>(name, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"United States of America"</span>, <span class="st">"USA"</span>, name)) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Bosnia and Herz."</span>, <span class="st">"Bosnia and Herzegovina"</span>, name)) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Czechia"</span>, <span class="st">"Czech Republic"</span>, name)) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"Taiwan"</span>, <span class="st">"Taiwan. ROC"</span>, name))</span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co"># Now let's standardize consumption for better comparison across foods</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>fcc_standardized <span class="ot">&lt;-</span> fcc <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="fu">select</span>(<span class="sc">-</span>co2_emmission) <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="fu">group_by</span>(food_category) <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>  <span class="fu">mutate</span>(<span class="at">consumption =</span> (consumption <span class="sc">-</span> <span class="fu">mean</span>(consumption))<span class="sc">/</span><span class="fu">sd</span>(consumption))</span>
<span id="cb13-14"><a href="#cb13-14"></a></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co"># Check the range of standardized values for each food</span></span>
<span id="cb13-16"><a href="#cb13-16"></a>food_stats <span class="ot">&lt;-</span> fcc_standardized <span class="sc">%&gt;%</span></span>
<span id="cb13-17"><a href="#cb13-17"></a>  <span class="fu">group_by</span>(food_category) <span class="sc">%&gt;%</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>  <span class="fu">summarize</span>(<span class="at">min =</span> <span class="fu">min</span>(consumption, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-19"><a href="#cb13-19"></a>            <span class="at">max =</span> <span class="fu">max</span>(consumption, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-20"><a href="#cb13-20"></a>            <span class="at">range =</span> max <span class="sc">-</span> min) <span class="sc">%&gt;%</span></span>
<span id="cb13-21"><a href="#cb13-21"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(range))</span>
<span id="cb13-22"><a href="#cb13-22"></a></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="fu">kable</span>(food_stats, <span class="at">caption =</span> <span class="st">"Range of Standardized Consumption Values by Food Category"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Range of Standardized Consumption Values by Food Category</caption>
<thead><tr class="header">
<th style="text-align: left;">food_category</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fish</td>
<td style="text-align: right;">-0.8965771</td>
<td style="text-align: right;">8.542502</td>
<td style="text-align: right;">9.439079</td>
</tr>
<tr class="even">
<td style="text-align: left;">Soybeans</td>
<td style="text-align: right;">-0.4130580</td>
<td style="text-align: right;">7.722933</td>
<td style="text-align: right;">8.135991</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nuts</td>
<td style="text-align: right;">-1.1732719</td>
<td style="text-align: right;">5.601481</td>
<td style="text-align: right;">6.774753</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lamb</td>
<td style="text-align: right;">-0.7094065</td>
<td style="text-align: right;">5.052816</td>
<td style="text-align: right;">5.762223</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Beef</td>
<td style="text-align: right;">-1.1749761</td>
<td style="text-align: right;">4.490987</td>
<td style="text-align: right;">5.665963</td>
</tr>
<tr class="even">
<td style="text-align: left;">Milk</td>
<td style="text-align: right;">-1.3150936</td>
<td style="text-align: right;">3.267896</td>
<td style="text-align: right;">4.582990</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rice</td>
<td style="text-align: right;">-0.7615688</td>
<td style="text-align: right;">3.813982</td>
<td style="text-align: right;">4.575551</td>
</tr>
<tr class="even">
<td style="text-align: left;">Wheat</td>
<td style="text-align: right;">-1.5570827</td>
<td style="text-align: right;">2.850118</td>
<td style="text-align: right;">4.407201</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pork</td>
<td style="text-align: right;">-1.0258338</td>
<td style="text-align: right;">3.243889</td>
<td style="text-align: right;">4.269723</td>
</tr>
<tr class="even">
<td style="text-align: left;">Poultry</td>
<td style="text-align: right;">-1.4239129</td>
<td style="text-align: right;">2.832887</td>
<td style="text-align: right;">4.256800</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Eggs</td>
<td style="text-align: right;">-1.5903902</td>
<td style="text-align: right;">2.183021</td>
<td style="text-align: right;">3.773411</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now I’ll create the improved choropleth maps:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Join data and create maps</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>consumption_map <span class="ot">&lt;-</span> world_map_fixed <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">left_join</span>(fcc_standardized, <span class="fu">join_by</span>(name <span class="sc">==</span> country)) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> food_category, <span class="at">values_from =</span> consumption) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">NA</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>name, <span class="sc">-</span>geometry),</span>
<span id="cb14-7"><a href="#cb14-7"></a>               <span class="at">names_to =</span> <span class="st">"food_category"</span>,</span>
<span id="cb14-8"><a href="#cb14-8"></a>               <span class="at">values_to =</span> <span class="st">"consumption"</span>)</span>
<span id="cb14-9"><a href="#cb14-9"></a></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co"># Create an enhanced map with better color palette and fixed legend</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="fu">ggplot</span>(consumption_map) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> consumption)) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">na.value =</span> <span class="st">"gray90"</span>) <span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>food_category, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Standardized Food Consumption Around the World"</span>,</span>
<span id="cb14-16"><a href="#cb14-16"></a>       <span class="at">subtitle =</span> <span class="st">"Values shown as standard deviations from mean consumption"</span>,</span>
<span id="cb14-17"><a href="#cb14-17"></a>       <span class="at">fill =</span> <span class="st">"Std. Consumption"</span>) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb14-20"><a href="#cb14-20"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb14-21"><a href="#cb14-21"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"lightgray"</span>),</span>
<span id="cb14-22"><a href="#cb14-22"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Zhijun-He-Exam2_files/figure-html/final_choropleth-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="reflections-and-enhancements" class="level2" data-number="7.7"><h2 data-number="7.7" class="anchored" data-anchor-id="reflections-and-enhancements">
<span class="header-section-number">7.7</span> Reflections and Enhancements</h2>
<p>The choropleth maps provide a wealth of insights, but several enhancements could make them even more effective:</p>
<ol type="1">
<li>Using a better color palette (like viridis) improves accessibility and makes patterns more visible</li>
<li>Adding a clear title and subtitle provides context for interpretation</li>
<li>Adjusting the facet_wrap layout to display maps in a more readable format</li>
<li>Including a proper legend with meaningful labels</li>
<li>Using a consistent scale across all maps allows for better comparisons</li>
<li>Adding borders between countries improves visual distinction</li>
</ol>
<p>These maps reveal fascinating global patterns in food consumption. Nordic countries excel in milk consumption, while Southeast Asian nations lead in rice. The beef map highlights South American leadership, particularly Argentina’s remarkable consumption levels. What’s particularly interesting is how standardization reveals outliers – countries that deviate significantly from average consumption patterns.</p>
</section><section id="conclusion" class="level2" data-number="7.8"><h2 data-number="7.8" class="anchored" data-anchor-id="conclusion">
<span class="header-section-number">7.8</span> Conclusion</h2>
<p>This exploration of global food consumption patterns has revealed fascinating insights about dietary habits across countries and regions. The analysis demonstrates not only which countries consume the most food overall but also where specific foods dominate cultural diets.</p>
<p>Through data wrangling and visualization, I’ve transformed raw numbers into meaningful insights. The standardized choropleth maps particularly highlight how consumption patterns vary globally, accounting for different scales across food categories. This standardization reveals which countries truly stand out in their consumption of specific foods relative to global averages.</p>
<p>The techniques employed – from data cleaning to advanced visualization – showcase how statistical analysis can uncover patterns in complex global datasets. These findings could inform discussions about food security, cultural dietary patterns, and the environmental impact of food production across different regions of the world.</p>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../bw/Zhijun He-Exam1.html" class="pagination-link" aria-label="Exam 1:Food Consumption and CO2 Emissions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Exam 1:Food Consumption and CO2 Emissions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../bw/Solo Project.html" class="pagination-link" aria-label="Australia Fires: A Spatial and Temporal Analysis">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Australia Fires: A Spatial and Temporal Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb15" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">---</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="an">title:</span><span class="co"> "Food Consumption-Zhijun's Exam 2"</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="an">author:</span><span class="co"> "Zhijun He"</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="an">date:</span><span class="co"> "April 01, 2025"</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">  html:</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">    toc: true</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co">    code-fold: false</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co">---</span></span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="fu">## Introduction</span></span>
<span id="cb15-12"><a href="#cb15-12"></a></span>
<span id="cb15-13"><a href="#cb15-13"></a>In this analysis, I'll explore the fascinating world of global food consumption patterns, examining which countries consume the most food overall, which ones lead in specific food categories, and visualizing consumption trends worldwide.</span>
<span id="cb15-14"><a href="#cb15-14"></a>The dataset from the TidyTuesday project (February 2020) provides insights into both food consumption and CO2 emissions across different countries and food categories.</span>
<span id="cb15-15"><a href="#cb15-15"></a>Through this exploration, I'll not only answer important research questions but also develop a deeper understanding of global nutrition patterns and their environmental impact.</span>
<span id="cb15-16"><a href="#cb15-16"></a></span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="fu">## Setting Up the Environment</span></span>
<span id="cb15-18"><a href="#cb15-18"></a></span>
<span id="cb15-19"><a href="#cb15-19"></a>First, I'll load the necessary packages and the dataset to begin our analysis journey:</span>
<span id="cb15-20"><a href="#cb15-20"></a></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="in">```{r setup, message=FALSE, warning=FALSE}</span></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="in">library(tidytuesdayR)</span></span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="in">library(tidyverse)</span></span>
<span id="cb15-24"><a href="#cb15-24"></a><span class="in">library(rnaturalearth) # for country boundaries</span></span>
<span id="cb15-25"><a href="#cb15-25"></a><span class="in">library(sf) # for spatial visualization</span></span>
<span id="cb15-26"><a href="#cb15-26"></a><span class="in">library(knitr) # for tables</span></span>
<span id="cb15-27"><a href="#cb15-27"></a></span>
<span id="cb15-28"><a href="#cb15-28"></a><span class="in"># Load the data</span></span>
<span id="cb15-29"><a href="#cb15-29"></a><span class="in">tuesdata &lt;- tt_load('2020-02-18')</span></span>
<span id="cb15-30"><a href="#cb15-30"></a><span class="in">fc &lt;- tuesdata$food_consumption</span></span>
<span id="cb15-31"><a href="#cb15-31"></a></span>
<span id="cb15-32"><a href="#cb15-32"></a><span class="in"># Initial data inspection</span></span>
<span id="cb15-33"><a href="#cb15-33"></a><span class="in">glimpse(fc)</span></span>
<span id="cb15-34"><a href="#cb15-34"></a><span class="in">```</span></span>
<span id="cb15-35"><a href="#cb15-35"></a></span>
<span id="cb15-36"><a href="#cb15-36"></a><span class="fu">## Data Cleaning</span></span>
<span id="cb15-37"><a href="#cb15-37"></a></span>
<span id="cb15-38"><a href="#cb15-38"></a>Before diving into the analysis, I need to clean up the food category names to make them more concise and consistent.</span>
<span id="cb15-39"><a href="#cb15-39"></a>The original names have inconsistent formatting and unnecessary verbosity that would clutter our visualizations.</span>
<span id="cb15-40"><a href="#cb15-40"></a></span>
<span id="cb15-41"><a href="#cb15-41"></a><span class="in">```{r clean_categories}</span></span>
<span id="cb15-42"><a href="#cb15-42"></a><span class="in"># First, let's examine the original food categories</span></span>
<span id="cb15-43"><a href="#cb15-43"></a><span class="in">unique(fc$food_category)</span></span>
<span id="cb15-44"><a href="#cb15-44"></a></span>
<span id="cb15-45"><a href="#cb15-45"></a><span class="in"># Clean up the food category names</span></span>
<span id="cb15-46"><a href="#cb15-46"></a><span class="in">fcc &lt;- fc %&gt;%</span></span>
<span id="cb15-47"><a href="#cb15-47"></a><span class="in">  mutate(food_category = case_when(</span></span>
<span id="cb15-48"><a href="#cb15-48"></a><span class="in">    food_category == "Lamb &amp; Goat" ~ "Lamb",</span></span>
<span id="cb15-49"><a href="#cb15-49"></a><span class="in">    food_category == "Milk - inc. cheese" ~ "Milk",</span></span>
<span id="cb15-50"><a href="#cb15-50"></a><span class="in">    food_category == "Wheat and Wheat Products" ~ "Wheat",</span></span>
<span id="cb15-51"><a href="#cb15-51"></a><span class="in">    food_category == "Nuts inc. Peanut Butter" ~ "Nuts",</span></span>
<span id="cb15-52"><a href="#cb15-52"></a><span class="in">    TRUE ~ food_category</span></span>
<span id="cb15-53"><a href="#cb15-53"></a><span class="in">  ))</span></span>
<span id="cb15-54"><a href="#cb15-54"></a></span>
<span id="cb15-55"><a href="#cb15-55"></a><span class="in"># Verify the changes</span></span>
<span id="cb15-56"><a href="#cb15-56"></a><span class="in">unique(fcc$food_category)</span></span>
<span id="cb15-57"><a href="#cb15-57"></a><span class="in">```</span></span>
<span id="cb15-58"><a href="#cb15-58"></a></span>
<span id="cb15-59"><a href="#cb15-59"></a>The transformation worked perfectly!</span>
<span id="cb15-60"><a href="#cb15-60"></a>I've streamlined the category names while preserving their meaning, which will make our visualizations cleaner and easier to interpret.</span>
<span id="cb15-61"><a href="#cb15-61"></a>This simple change fundamentally transforms how we'll perceive patterns in the data.</span>
<span id="cb15-62"><a href="#cb15-62"></a></span>
<span id="cb15-63"><a href="#cb15-63"></a><span class="fu">## Research Question 1: Which 5 countries consume the most food?</span></span>
<span id="cb15-64"><a href="#cb15-64"></a></span>
<span id="cb15-65"><a href="#cb15-65"></a>To answer this question, I need to calculate the total consumption for each country across all food categories.</span>
<span id="cb15-66"><a href="#cb15-66"></a></span>
<span id="cb15-67"><a href="#cb15-67"></a><span class="fu">### Expected Shape</span></span>
<span id="cb15-68"><a href="#cb15-68"></a></span>
<span id="cb15-69"><a href="#cb15-69"></a>The resulting dataframe should have 2 columns: - country: character (5 rows) - total_consumption: numeric (total kg/person/year)</span>
<span id="cb15-70"><a href="#cb15-70"></a></span>
<span id="cb15-71"><a href="#cb15-71"></a><span class="fu">### Steps</span></span>
<span id="cb15-72"><a href="#cb15-72"></a></span>
<span id="cb15-73"><a href="#cb15-73"></a><span class="in">```{r most_consuming_countries}</span></span>
<span id="cb15-74"><a href="#cb15-74"></a><span class="in"># 1. Group by country</span></span>
<span id="cb15-75"><a href="#cb15-75"></a><span class="in"># 2. Sum consumption across all food categories</span></span>
<span id="cb15-76"><a href="#cb15-76"></a><span class="in"># 3. Arrange in descending order</span></span>
<span id="cb15-77"><a href="#cb15-77"></a><span class="in"># 4. Select top 5 countries</span></span>
<span id="cb15-78"><a href="#cb15-78"></a></span>
<span id="cb15-79"><a href="#cb15-79"></a><span class="in">top_consumers &lt;- fcc %&gt;%</span></span>
<span id="cb15-80"><a href="#cb15-80"></a><span class="in">  group_by(country) %&gt;%</span></span>
<span id="cb15-81"><a href="#cb15-81"></a><span class="in">  summarize(total_consumption = sum(consumption, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb15-82"><a href="#cb15-82"></a><span class="in">  arrange(desc(total_consumption)) %&gt;%</span></span>
<span id="cb15-83"><a href="#cb15-83"></a><span class="in">  slice_head(n = 5)</span></span>
<span id="cb15-84"><a href="#cb15-84"></a></span>
<span id="cb15-85"><a href="#cb15-85"></a><span class="in"># Display as a table</span></span>
<span id="cb15-86"><a href="#cb15-86"></a><span class="in">kable(top_consumers, caption = "Top 5 Countries by Total Food Consumption (kg/person/year)")</span></span>
<span id="cb15-87"><a href="#cb15-87"></a><span class="in">```</span></span>
<span id="cb15-88"><a href="#cb15-88"></a></span>
<span id="cb15-89"><a href="#cb15-89"></a><span class="fu">### Visualization</span></span>
<span id="cb15-90"><a href="#cb15-90"></a></span>
<span id="cb15-91"><a href="#cb15-91"></a>A horizontal bar chart would be the most appropriate visualization for this data:</span>
<span id="cb15-92"><a href="#cb15-92"></a></span>
<span id="cb15-93"><a href="#cb15-93"></a><span class="in">```{r top_consumers_viz, fig.height=4, fig.width=8}</span></span>
<span id="cb15-94"><a href="#cb15-94"></a><span class="in"># Create a bar chart of top consuming countries</span></span>
<span id="cb15-95"><a href="#cb15-95"></a><span class="in">ggplot(top_consumers, aes(x = reorder(country, total_consumption), y = total_consumption)) +</span></span>
<span id="cb15-96"><a href="#cb15-96"></a><span class="in">  geom_col(fill = "steelblue") +</span></span>
<span id="cb15-97"><a href="#cb15-97"></a><span class="in">  coord_flip() +</span></span>
<span id="cb15-98"><a href="#cb15-98"></a><span class="in">  labs(title = "Top 5 Countries by Total Food Consumption",</span></span>
<span id="cb15-99"><a href="#cb15-99"></a><span class="in">       subtitle = "Total kg per person per year",</span></span>
<span id="cb15-100"><a href="#cb15-100"></a><span class="in">       x = NULL,</span></span>
<span id="cb15-101"><a href="#cb15-101"></a><span class="in">       y = "Total Consumption (kg/person/year)") +</span></span>
<span id="cb15-102"><a href="#cb15-102"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb15-103"><a href="#cb15-103"></a><span class="in">  theme(plot.title = element_text(face = "bold"),</span></span>
<span id="cb15-104"><a href="#cb15-104"></a><span class="in">        axis.text.y = element_text(size = 11))</span></span>
<span id="cb15-105"><a href="#cb15-105"></a><span class="in">```</span></span>
<span id="cb15-106"><a href="#cb15-106"></a></span>
<span id="cb15-107"><a href="#cb15-107"></a>The results reveal fascinating insights about global consumption patterns!</span>
<span id="cb15-108"><a href="#cb15-108"></a>The United States leads in total food consumption per person, followed closely by several European countries.</span>
<span id="cb15-109"><a href="#cb15-109"></a>This reflects both cultural dietary differences and economic factors that influence food availability and consumption habits.</span>
<span id="cb15-110"><a href="#cb15-110"></a></span>
<span id="cb15-111"><a href="#cb15-111"></a><span class="fu">## Research Question 2: Which top 5 countries consume each food category the most?</span></span>
<span id="cb15-112"><a href="#cb15-112"></a></span>
<span id="cb15-113"><a href="#cb15-113"></a>Now I'll dig deeper to identify consumption leaders for each specific food category.</span>
<span id="cb15-114"><a href="#cb15-114"></a></span>
<span id="cb15-115"><a href="#cb15-115"></a><span class="fu">### Expected Shape</span></span>
<span id="cb15-116"><a href="#cb15-116"></a></span>
<span id="cb15-117"><a href="#cb15-117"></a>The resulting dataframe should have 3 columns: - food_category: character (11 different foods x 5 countries = 55 rows) - country: character - consumption: numeric (kg/person/year)</span>
<span id="cb15-118"><a href="#cb15-118"></a></span>
<span id="cb15-119"><a href="#cb15-119"></a><span class="fu">### Steps</span></span>
<span id="cb15-120"><a href="#cb15-120"></a></span>
<span id="cb15-121"><a href="#cb15-121"></a><span class="in">```{r top_consumers_by_food}</span></span>
<span id="cb15-122"><a href="#cb15-122"></a><span class="in"># 1. Group by food_category</span></span>
<span id="cb15-123"><a href="#cb15-123"></a><span class="in"># 2. Arrange in descending order within each group</span></span>
<span id="cb15-124"><a href="#cb15-124"></a><span class="in"># 3. Select top 5 countries for each food category</span></span>
<span id="cb15-125"><a href="#cb15-125"></a><span class="in"># 4. Keep food_category, country, and consumption columns</span></span>
<span id="cb15-126"><a href="#cb15-126"></a></span>
<span id="cb15-127"><a href="#cb15-127"></a><span class="in">top_by_food &lt;- fcc %&gt;%</span></span>
<span id="cb15-128"><a href="#cb15-128"></a><span class="in">  group_by(food_category) %&gt;%</span></span>
<span id="cb15-129"><a href="#cb15-129"></a><span class="in">  arrange(desc(consumption)) %&gt;%</span></span>
<span id="cb15-130"><a href="#cb15-130"></a><span class="in">  slice_head(n = 5) %&gt;%</span></span>
<span id="cb15-131"><a href="#cb15-131"></a><span class="in">  select(food_category, country, consumption)</span></span>
<span id="cb15-132"><a href="#cb15-132"></a></span>
<span id="cb15-133"><a href="#cb15-133"></a><span class="in"># Display the first 15 rows (to keep the output manageable)</span></span>
<span id="cb15-134"><a href="#cb15-134"></a><span class="in">kable(head(top_by_food, 15), caption = "Sample of Top 5 Countries by Food Category (First 3 Categories)")</span></span>
<span id="cb15-135"><a href="#cb15-135"></a><span class="in">```</span></span>
<span id="cb15-136"><a href="#cb15-136"></a></span>
<span id="cb15-137"><a href="#cb15-137"></a><span class="fu">### Visualization</span></span>
<span id="cb15-138"><a href="#cb15-138"></a></span>
<span id="cb15-139"><a href="#cb15-139"></a>A faceted bar chart would be the most appropriate visualization for this data:</span>
<span id="cb15-140"><a href="#cb15-140"></a></span>
<span id="cb15-141"><a href="#cb15-141"></a><span class="in">```{r top_by_food_viz, fig.height=12, fig.width=10}</span></span>
<span id="cb15-142"><a href="#cb15-142"></a><span class="in"># Create faceted bar chart</span></span>
<span id="cb15-143"><a href="#cb15-143"></a><span class="in">ggplot(top_by_food, aes(x = reorder(country, consumption), y = consumption)) +</span></span>
<span id="cb15-144"><a href="#cb15-144"></a><span class="in">  geom_col(fill = "darkgreen") +</span></span>
<span id="cb15-145"><a href="#cb15-145"></a><span class="in">  facet_wrap(~food_category, scales = "free_y", ncol = 2) +</span></span>
<span id="cb15-146"><a href="#cb15-146"></a><span class="in">  coord_flip() +</span></span>
<span id="cb15-147"><a href="#cb15-147"></a><span class="in">  labs(title = "Top 5 Countries by Food Category Consumption",</span></span>
<span id="cb15-148"><a href="#cb15-148"></a><span class="in">       subtitle = "Measured in kg per person per year",</span></span>
<span id="cb15-149"><a href="#cb15-149"></a><span class="in">       x = NULL,</span></span>
<span id="cb15-150"><a href="#cb15-150"></a><span class="in">       y = "Consumption (kg/person/year)") +</span></span>
<span id="cb15-151"><a href="#cb15-151"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb15-152"><a href="#cb15-152"></a><span class="in">  theme(plot.title = element_text(face = "bold"),</span></span>
<span id="cb15-153"><a href="#cb15-153"></a><span class="in">        strip.background = element_rect(fill = "lightgray"),</span></span>
<span id="cb15-154"><a href="#cb15-154"></a><span class="in">        strip.text = element_text(face = "bold"))</span></span>
<span id="cb15-155"><a href="#cb15-155"></a><span class="in">```</span></span>
<span id="cb15-156"><a href="#cb15-156"></a></span>
<span id="cb15-157"><a href="#cb15-157"></a>What a fascinating glimpse into global eating habits!</span>
<span id="cb15-158"><a href="#cb15-158"></a>The visualization reveals striking regional specialization patterns.</span>
<span id="cb15-159"><a href="#cb15-159"></a>Nordic countries dominate milk consumption, while Asian countries lead in rice consumption.</span>
<span id="cb15-160"><a href="#cb15-160"></a>The beef visualization demonstrates South American countries' strong cattle industries, particularly Argentina.</span>
<span id="cb15-161"><a href="#cb15-161"></a>These patterns reflect not just what people eat, but centuries of agricultural development, cultural preferences, and geographic influences shaping our food systems.</span>
<span id="cb15-162"><a href="#cb15-162"></a></span>
<span id="cb15-163"><a href="#cb15-163"></a><span class="fu">## Research Question 3: What does the consumption of each food look like globally?</span></span>
<span id="cb15-164"><a href="#cb15-164"></a></span>
<span id="cb15-165"><a href="#cb15-165"></a>For this question, I'll create choropleth maps showing consumption patterns across countries for each food category.</span>
<span id="cb15-166"><a href="#cb15-166"></a></span>
<span id="cb15-167"><a href="#cb15-167"></a><span class="fu">### Expected Shape</span></span>
<span id="cb15-168"><a href="#cb15-168"></a></span>
<span id="cb15-169"><a href="#cb15-169"></a>After joining with geographical data, the dataframe should have: - name: character (country name from map data) - geometry: sf geometry - food_category: character (pivoted) - consumption: numeric (standardized)</span>
<span id="cb15-170"><a href="#cb15-170"></a></span>
<span id="cb15-171"><a href="#cb15-171"></a><span class="fu">### Steps</span></span>
<span id="cb15-172"><a href="#cb15-172"></a></span>
<span id="cb15-173"><a href="#cb15-173"></a><span class="in">```{r choropleth_prep, message=FALSE, warning=FALSE}</span></span>
<span id="cb15-174"><a href="#cb15-174"></a><span class="in"># First attempt at creating a choropleth map</span></span>
<span id="cb15-175"><a href="#cb15-175"></a></span>
<span id="cb15-176"><a href="#cb15-176"></a><span class="in"># 1. Get country boundaries</span></span>
<span id="cb15-177"><a href="#cb15-177"></a><span class="in"># 2. Select name and geometry</span></span>
<span id="cb15-178"><a href="#cb15-178"></a><span class="in"># 3. Join with consumption data</span></span>
<span id="cb15-179"><a href="#cb15-179"></a><span class="in"># 4. Create the map</span></span>
<span id="cb15-180"><a href="#cb15-180"></a></span>
<span id="cb15-181"><a href="#cb15-181"></a><span class="in"># First, let's identify countries with missing data</span></span>
<span id="cb15-182"><a href="#cb15-182"></a><span class="in">countries_with_data &lt;- unique(fcc$country)</span></span>
<span id="cb15-183"><a href="#cb15-183"></a><span class="in">world_map &lt;- ne_countries(returnclass = "sf") %&gt;%</span></span>
<span id="cb15-184"><a href="#cb15-184"></a><span class="in">  select(name, geometry)</span></span>
<span id="cb15-185"><a href="#cb15-185"></a></span>
<span id="cb15-186"><a href="#cb15-186"></a><span class="in">missing_countries &lt;- world_map %&gt;%</span></span>
<span id="cb15-187"><a href="#cb15-187"></a><span class="in">  filter(!name %in% countries_with_data) %&gt;%</span></span>
<span id="cb15-188"><a href="#cb15-188"></a><span class="in">  st_drop_geometry() %&gt;%</span></span>
<span id="cb15-189"><a href="#cb15-189"></a><span class="in">  select(name)</span></span>
<span id="cb15-190"><a href="#cb15-190"></a></span>
<span id="cb15-191"><a href="#cb15-191"></a><span class="in"># First few missing countries</span></span>
<span id="cb15-192"><a href="#cb15-192"></a><span class="in">head(missing_countries, 10)</span></span>
<span id="cb15-193"><a href="#cb15-193"></a><span class="in">```</span></span>
<span id="cb15-194"><a href="#cb15-194"></a></span>
<span id="cb15-195"><a href="#cb15-195"></a>I notice that there's a name mismatch between our consumption data and the natural earth map data.</span>
<span id="cb15-196"><a href="#cb15-196"></a>Several countries appear as "missing" because of naming differences.</span>
<span id="cb15-197"><a href="#cb15-197"></a>For instance, "United States of America" in the map data versus "USA" in the consumption data.</span>
<span id="cb15-198"><a href="#cb15-198"></a></span>
<span id="cb15-199"><a href="#cb15-199"></a>Let's fix these discrepancies and create an improved visualization:</span>
<span id="cb15-200"><a href="#cb15-200"></a></span>
<span id="cb15-201"><a href="#cb15-201"></a><span class="in">```{r fix_country_names, message=FALSE, warning=FALSE}</span></span>
<span id="cb15-202"><a href="#cb15-202"></a><span class="in"># Fix country name mismatches</span></span>
<span id="cb15-203"><a href="#cb15-203"></a><span class="in">world_map_fixed &lt;- ne_countries(returnclass = "sf") %&gt;%</span></span>
<span id="cb15-204"><a href="#cb15-204"></a><span class="in">  select(name, geometry) %&gt;%</span></span>
<span id="cb15-205"><a href="#cb15-205"></a><span class="in">  mutate(name = ifelse(name == "United States of America", "USA", name)) %&gt;%</span></span>
<span id="cb15-206"><a href="#cb15-206"></a><span class="in">  mutate(name = ifelse(name == "Bosnia and Herz.", "Bosnia and Herzegovina", name)) %&gt;%</span></span>
<span id="cb15-207"><a href="#cb15-207"></a><span class="in">  mutate(name = ifelse(name == "Czechia", "Czech Republic", name)) %&gt;%</span></span>
<span id="cb15-208"><a href="#cb15-208"></a><span class="in">  mutate(name = ifelse(name == "Taiwan", "Taiwan. ROC", name))</span></span>
<span id="cb15-209"><a href="#cb15-209"></a></span>
<span id="cb15-210"><a href="#cb15-210"></a><span class="in"># Now let's standardize consumption for better comparison across foods</span></span>
<span id="cb15-211"><a href="#cb15-211"></a><span class="in">fcc_standardized &lt;- fcc %&gt;%</span></span>
<span id="cb15-212"><a href="#cb15-212"></a><span class="in">  select(-co2_emmission) %&gt;%</span></span>
<span id="cb15-213"><a href="#cb15-213"></a><span class="in">  group_by(food_category) %&gt;%</span></span>
<span id="cb15-214"><a href="#cb15-214"></a><span class="in">  mutate(consumption = (consumption - mean(consumption))/sd(consumption))</span></span>
<span id="cb15-215"><a href="#cb15-215"></a></span>
<span id="cb15-216"><a href="#cb15-216"></a><span class="in"># Check the range of standardized values for each food</span></span>
<span id="cb15-217"><a href="#cb15-217"></a><span class="in">food_stats &lt;- fcc_standardized %&gt;%</span></span>
<span id="cb15-218"><a href="#cb15-218"></a><span class="in">  group_by(food_category) %&gt;%</span></span>
<span id="cb15-219"><a href="#cb15-219"></a><span class="in">  summarize(min = min(consumption, na.rm = TRUE),</span></span>
<span id="cb15-220"><a href="#cb15-220"></a><span class="in">            max = max(consumption, na.rm = TRUE),</span></span>
<span id="cb15-221"><a href="#cb15-221"></a><span class="in">            range = max - min) %&gt;%</span></span>
<span id="cb15-222"><a href="#cb15-222"></a><span class="in">  arrange(desc(range))</span></span>
<span id="cb15-223"><a href="#cb15-223"></a></span>
<span id="cb15-224"><a href="#cb15-224"></a><span class="in">kable(food_stats, caption = "Range of Standardized Consumption Values by Food Category")</span></span>
<span id="cb15-225"><a href="#cb15-225"></a><span class="in">```</span></span>
<span id="cb15-226"><a href="#cb15-226"></a></span>
<span id="cb15-227"><a href="#cb15-227"></a>Now I'll create the improved choropleth maps:</span>
<span id="cb15-228"><a href="#cb15-228"></a></span>
<span id="cb15-229"><a href="#cb15-229"></a><span class="in">```{r final_choropleth, fig.height=22, fig.width=11, message=FALSE, warning=FALSE}</span></span>
<span id="cb15-230"><a href="#cb15-230"></a><span class="in"># Join data and create maps</span></span>
<span id="cb15-231"><a href="#cb15-231"></a><span class="in">consumption_map &lt;- world_map_fixed %&gt;%</span></span>
<span id="cb15-232"><a href="#cb15-232"></a><span class="in">  left_join(fcc_standardized, join_by(name == country)) %&gt;%</span></span>
<span id="cb15-233"><a href="#cb15-233"></a><span class="in">  pivot_wider(names_from = food_category, values_from = consumption) %&gt;%</span></span>
<span id="cb15-234"><a href="#cb15-234"></a><span class="in">  select(-`NA`) %&gt;%</span></span>
<span id="cb15-235"><a href="#cb15-235"></a><span class="in">  pivot_longer(cols = c(-name, -geometry),</span></span>
<span id="cb15-236"><a href="#cb15-236"></a><span class="in">               names_to = "food_category",</span></span>
<span id="cb15-237"><a href="#cb15-237"></a><span class="in">               values_to = "consumption")</span></span>
<span id="cb15-238"><a href="#cb15-238"></a></span>
<span id="cb15-239"><a href="#cb15-239"></a><span class="in"># Create an enhanced map with better color palette and fixed legend</span></span>
<span id="cb15-240"><a href="#cb15-240"></a><span class="in">ggplot(consumption_map) +</span></span>
<span id="cb15-241"><a href="#cb15-241"></a><span class="in">  geom_sf(aes(fill = consumption)) +</span></span>
<span id="cb15-242"><a href="#cb15-242"></a><span class="in">  scale_fill_viridis_c(option = "plasma", na.value = "gray90") +</span></span>
<span id="cb15-243"><a href="#cb15-243"></a><span class="in">  facet_wrap(~food_category, ncol = 2) +</span></span>
<span id="cb15-244"><a href="#cb15-244"></a><span class="in">  labs(title = "Standardized Food Consumption Around the World",</span></span>
<span id="cb15-245"><a href="#cb15-245"></a><span class="in">       subtitle = "Values shown as standard deviations from mean consumption",</span></span>
<span id="cb15-246"><a href="#cb15-246"></a><span class="in">       fill = "Std. Consumption") +</span></span>
<span id="cb15-247"><a href="#cb15-247"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb15-248"><a href="#cb15-248"></a><span class="in">  theme(legend.position = "bottom",</span></span>
<span id="cb15-249"><a href="#cb15-249"></a><span class="in">        plot.title = element_text(face = "bold", size = 16),</span></span>
<span id="cb15-250"><a href="#cb15-250"></a><span class="in">        strip.background = element_rect(fill = "lightgray"),</span></span>
<span id="cb15-251"><a href="#cb15-251"></a><span class="in">        strip.text = element_text(face = "bold", size = 12))</span></span>
<span id="cb15-252"><a href="#cb15-252"></a><span class="in">```</span></span>
<span id="cb15-253"><a href="#cb15-253"></a></span>
<span id="cb15-254"><a href="#cb15-254"></a><span class="fu">## Reflections and Enhancements</span></span>
<span id="cb15-255"><a href="#cb15-255"></a></span>
<span id="cb15-256"><a href="#cb15-256"></a>The choropleth maps provide a wealth of insights, but several enhancements could make them even more effective:</span>
<span id="cb15-257"><a href="#cb15-257"></a></span>
<span id="cb15-258"><a href="#cb15-258"></a><span class="ss">1.  </span>Using a better color palette (like viridis) improves accessibility and makes patterns more visible</span>
<span id="cb15-259"><a href="#cb15-259"></a><span class="ss">2.  </span>Adding a clear title and subtitle provides context for interpretation</span>
<span id="cb15-260"><a href="#cb15-260"></a><span class="ss">3.  </span>Adjusting the facet_wrap layout to display maps in a more readable format</span>
<span id="cb15-261"><a href="#cb15-261"></a><span class="ss">4.  </span>Including a proper legend with meaningful labels</span>
<span id="cb15-262"><a href="#cb15-262"></a><span class="ss">5.  </span>Using a consistent scale across all maps allows for better comparisons</span>
<span id="cb15-263"><a href="#cb15-263"></a><span class="ss">6.  </span>Adding borders between countries improves visual distinction</span>
<span id="cb15-264"><a href="#cb15-264"></a></span>
<span id="cb15-265"><a href="#cb15-265"></a>These maps reveal fascinating global patterns in food consumption.</span>
<span id="cb15-266"><a href="#cb15-266"></a>Nordic countries excel in milk consumption, while Southeast Asian nations lead in rice.</span>
<span id="cb15-267"><a href="#cb15-267"></a>The beef map highlights South American leadership, particularly Argentina's remarkable consumption levels.</span>
<span id="cb15-268"><a href="#cb15-268"></a>What's particularly interesting is how standardization reveals outliers – countries that deviate significantly from average consumption patterns.</span>
<span id="cb15-269"><a href="#cb15-269"></a></span>
<span id="cb15-270"><a href="#cb15-270"></a><span class="fu">## Conclusion</span></span>
<span id="cb15-271"><a href="#cb15-271"></a></span>
<span id="cb15-272"><a href="#cb15-272"></a>This exploration of global food consumption patterns has revealed fascinating insights about dietary habits across countries and regions.</span>
<span id="cb15-273"><a href="#cb15-273"></a>The analysis demonstrates not only which countries consume the most food overall but also where specific foods dominate cultural diets.</span>
<span id="cb15-274"><a href="#cb15-274"></a></span>
<span id="cb15-275"><a href="#cb15-275"></a>Through data wrangling and visualization, I've transformed raw numbers into meaningful insights.</span>
<span id="cb15-276"><a href="#cb15-276"></a>The standardized choropleth maps particularly highlight how consumption patterns vary globally, accounting for different scales across food categories.</span>
<span id="cb15-277"><a href="#cb15-277"></a>This standardization reveals which countries truly stand out in their consumption of specific foods relative to global averages.</span>
<span id="cb15-278"><a href="#cb15-278"></a></span>
<span id="cb15-279"><a href="#cb15-279"></a>The techniques employed – from data cleaning to advanced visualization – showcase how statistical analysis can uncover patterns in complex global datasets.</span>
<span id="cb15-280"><a href="#cb15-280"></a>These findings could inform discussions about food security, cultural dietary patterns, and the environmental impact of food production across different regions of the world.</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>