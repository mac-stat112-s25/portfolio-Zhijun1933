<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>16&nbsp; Working with Factors – COMP/STAT112 Notebook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../ica/ica-working with strings.html" rel="next">
<link href="../ica/ica-joining data.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../style/custom.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../ica/ica-uni.html">In-class Activities</a></li><li class="breadcrumb-item"><a href="../ica/ica-working with factors.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Working with Factors</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Zhijun He</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Best Work</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/bw-uni.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Univariate Visualization-Best Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/bw-bi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bivariate Visualization-Best Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/bw-tri.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Trivariate Visualization-Best Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/bw-quad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Quadvariate Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/bw-spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spatial Viz-Best Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bw/Zhijun He-Exam1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Exam 1:Food Consumption and CO2 Emissions</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">In-class Activities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-uni.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Univariate Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-bi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Bivariate Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-multi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Multivariate Viz</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/real-ica-spacial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Spatial Visualization Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-effective viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Effective Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-data wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-working with dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Working with Dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-reshaping data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Reshaping Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-joining data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Joining Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-working with factors.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Working with Factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-working with strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Working with Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-working with data import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Import</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ica/ica-EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals"><span class="header-section-number">16.1</span> Learning Goals</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources"><span class="header-section-number">16.2</span> Additional Resources</a></li>
  <li><a href="#review" id="toc-review" class="nav-link" data-scroll-target="#review"><span class="header-section-number">16.3</span> 12.1 Review</a></li>
  <li>
<a href="#factors" id="toc-factors" class="nav-link" data-scroll-target="#factors"><span class="header-section-number">16.4</span> 12.2 Factors</a>
  <ul class="collapse">
<li><a href="#example-1-default-order" id="toc-example-1-default-order" class="nav-link" data-scroll-target="#example-1-default-order"><span class="header-section-number">16.4.1</span> Example 1: Default Order</a></li>
  <li><a href="#example-2-change-order-using-fct_relevel" id="toc-example-2-change-order-using-fct_relevel" class="nav-link" data-scroll-target="#example-2-change-order-using-fct_relevel"><span class="header-section-number">16.4.2</span> Example 2: Change Order using fct_relevel</a></li>
  <li><a href="#example-3-change-labels-using-fct_recode" id="toc-example-3-change-labels-using-fct_recode" class="nav-link" data-scroll-target="#example-3-change-labels-using-fct_recode"><span class="header-section-number">16.4.3</span> Example 3: Change Labels using fct_recode</a></li>
  <li><a href="#example-4-re-order-levels-using-fct_relevel" id="toc-example-4-re-order-levels-using-fct_relevel" class="nav-link" data-scroll-target="#example-4-re-order-levels-using-fct_relevel"><span class="header-section-number">16.4.4</span> Example 4: Re-order Levels using fct_relevel</a></li>
  <li><a href="#example-5-re-order-levels-based-on-another-variable-using-fct_reorder" id="toc-example-5-re-order-levels-based-on-another-variable-using-fct_reorder" class="nav-link" data-scroll-target="#example-5-re-order-levels-based-on-another-variable-using-fct_reorder"><span class="header-section-number">16.4.5</span> Example 5: Re-order levels Based on Another Variable using fct_reorder</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">16.4.6</span> Summary</a></li>
  </ul>
</li>
  <li>
<a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">16.5</span> 12.3 Exercises</a>
  <ul class="collapse">
<li><a href="#exercise-1-changing-order" id="toc-exercise-1-changing-order" class="nav-link" data-scroll-target="#exercise-1-changing-order"><span class="header-section-number">16.5.1</span> Exercise 1: Changing Order</a></li>
  <li><a href="#exercise-2-changing-factor-level-labels" id="toc-exercise-2-changing-factor-level-labels" class="nav-link" data-scroll-target="#exercise-2-changing-factor-level-labels"><span class="header-section-number">16.5.2</span> Exercise 2: Changing Factor Level Labels</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../ica/ica-uni.html">In-class Activities</a></li><li class="breadcrumb-item"><a href="../ica/ica-working with factors.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Working with Factors</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Working with Factors</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="learning-goals" class="level2" data-number="16.1"><h2 data-number="16.1" class="anchored" data-anchor-id="learning-goals">
<span class="header-section-number">16.1</span> Learning Goals</h2>
<ul>
<li>Understand the difference between character and factor variables.</li>
<li>Be able to convert a character variable to a factor.</li>
<li>Develop comfort in manipulating the order and values of a factor.</li>
</ul></section><section id="additional-resources" class="level2" data-number="16.2"><h2 data-number="16.2" class="anchored" data-anchor-id="additional-resources">
<span class="header-section-number">16.2</span> Additional Resources</h2>
<p>For more information about the topics covered in this chapter, refer to the resources below:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/factors.pdf">forcats cheat sheet (pdf)</a></li>
<li>
<a href="https://r4ds.had.co.nz/factors.html">Factors (html)</a> by Wickham &amp; Grolemund</li>
</ul></section><section id="review" class="level2" data-number="16.3"><h2 data-number="16.3" class="anchored" data-anchor-id="review">
<span class="header-section-number">16.3</span> 12.1 Review</h2>
<p>Where are we? Data preparation</p>
<p>Thus far, we’ve learned how to:</p>
<ul>
<li>do some wrangling:
<ul>
<li>arrange() our data in a meaningful order</li>
<li>subset the data to only filter() the rows and select() the columns of interest</li>
<li>mutate() existing variables and define new variables</li>
<li>summarize() various aspects of a variable, both overall and by group (group_by())</li>
<li>reshape our data to fit the task at hand (pivot_longer(), pivot_wider())</li>
<li>join() different datasets into one</li>
</ul>
</li>
</ul></section><section id="factors" class="level2" data-number="16.4"><h2 data-number="16.4" class="anchored" data-anchor-id="factors">
<span class="header-section-number">16.4</span> 12.2 Factors</h2>
<p>In the remaining days of our data preparation unit, we’ll focus on working with special types of “categorical” variables: characters and factors. Variables with these structures often require special tools and considerations.</p>
<p>We’ll focus on two common considerations:</p>
<ol type="1">
<li>
<p><strong>Regular expressions</strong> When working with character strings, we might want to detect, replace, or extract certain patterns. For example, recall our data on courses:</p>
<pre><code>    sessionID dept level    sem enroll     iid
1 session1784    M   100 FA1991     22 inst265
2 session1785    k   100 FA1991     52 inst458
3 session1791    J   100 FA1993     22 inst223
4 session1792    J   300 FA1993     20 inst235
5 session1794    J   200 FA1993     22 inst234
6 session1795    J   200 SP1994     26 inst230</code></pre>
<p>Focusing on just the sem character variable, we might want to…</p>
<ul>
<li>change FA to fall_ and SP to spring_</li>
<li>keep only courses taught in fall</li>
<li>split the variable into 2 new variables: semester (FA or SP) and year</li>
</ul>
</li>
<li><p><strong>Converting characters to factors (and factors to meaningful factors)</strong> (today) When categorical information is stored as a character variable, the categories of interest might not be labeled or ordered in a meaningful way. We can fix that!</p></li>
</ol>
<section id="example-1-default-order" class="level3" data-number="16.4.1"><h3 data-number="16.4.1" class="anchored" data-anchor-id="example-1-default-order">
<span class="header-section-number">16.4.1</span> Example 1: Default Order</h3>
<p>Recall our data on presidential election outcomes in each U.S. county (except those in Alaska):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>elections <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://mac-stat.github.io/data/election_2020_county.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">select</span>(state_abbr, historical, county_name, total_votes_20, repub_pct_20, dem_pct_20) <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">mutate</span>(<span class="at">dem_support_20 =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-4"><a href="#cb4-4"></a>    (repub_pct_20 <span class="sc">-</span> dem_pct_20 <span class="sc">&gt;=</span> <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"low"</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    (repub_pct_20 <span class="sc">-</span> dem_pct_20 <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">5</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="at">.default =</span> <span class="st">"medium"</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>  ))</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co"># Check it out</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="fu">head</span>(elections)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  state_abbr historical    county_name total_votes_20 repub_pct_20 dem_pct_20
1         AL        red Autauga County          27770        71.44      27.02
2         AL        red Baldwin County         109679        76.17      22.41
3         AL        red Barbour County          10518        53.45      45.79
4         AL        red    Bibb County           9595        78.43      20.70
5         AL        red  Blount County          27588        89.57       9.57
6         AL        red Bullock County           4613        24.84      74.70
  dem_support_20
1            low
2            low
3            low
4            low
5            low
6           high</code></pre>
</div>
</div>
<p>Check out the below visual and numerical summaries of dem_support_20:</p>
<ul>
<li>low = the Republican won the county by at least 5 percentage points</li>
<li>medium = the Republican and Democrat votes were within 5 percentage points</li>
<li>high = the Democrat won the county by at least 5 percentage points</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">ggplot</span>(elections, <span class="fu">aes</span>(<span class="at">x =</span> dem_support_20)) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">count</span>(dem_support_20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  dem_support_20    n
1           high  458
2            low 2494
3         medium  157</code></pre>
</div>
</div>
<p><strong>Follow-up:</strong></p>
<p>What don’t you like about these results?</p>
<p><em>The categories are in alphabetical order (high, low, medium), which isn’t particularly meaningful in this context. We would probably prefer them to be ordered by level of Democratic support (low, medium, high).</em></p>
</section><section id="example-2-change-order-using-fct_relevel" class="level3" data-number="16.4.2"><h3 data-number="16.4.2" class="anchored" data-anchor-id="example-2-change-order-using-fct_relevel">
<span class="header-section-number">16.4.2</span> Example 2: Change Order using fct_relevel</h3>
<p>The above categories of dem_support_20 are listed alphabetically, which isn’t particularly meaningful here. This is because dem_support_20 is a character variable and R thinks of character strings as words, not category labels with any meaningful order (other than alphabetical):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">str</span>(elections)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   3109 obs. of  7 variables:
 $ state_abbr    : chr  "AL" "AL" "AL" "AL" ...
 $ historical    : chr  "red" "red" "red" "red" ...
 $ county_name   : chr  "Autauga County" "Baldwin County" "Barbour County" "Bibb County" ...
 $ total_votes_20: int  27770 109679 10518 9595 27588 4613 9488 50983 15284 12301 ...
 $ repub_pct_20  : num  71.4 76.2 53.5 78.4 89.6 ...
 $ dem_pct_20    : num  27.02 22.41 45.79 20.7 9.57 ...
 $ dem_support_20: chr  "low" "low" "low" "low" ...</code></pre>
</div>
</div>
<p>We can fix this by using fct_relevel() to both:</p>
<ol type="1">
<li><p>Store dem_support_20 as a factor variable, the levels of which are recognized as specific levels or categories, not just words.</p></li>
<li><p>Specify a meaningful order for the levels of the factor variable.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Notice that the order of the levels is not alphabetical!</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>elections <span class="ot">&lt;-</span> elections <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">mutate</span>(<span class="at">dem_support_20 =</span> <span class="fu">fct_relevel</span>(dem_support_20, <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span>)))</span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co"># Notice the new structure of the dem_support_20 variable</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="fu">str</span>(elections)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   3109 obs. of  7 variables:
 $ state_abbr    : chr  "AL" "AL" "AL" "AL" ...
 $ historical    : chr  "red" "red" "red" "red" ...
 $ county_name   : chr  "Autauga County" "Baldwin County" "Barbour County" "Bibb County" ...
 $ total_votes_20: int  27770 109679 10518 9595 27588 4613 9488 50983 15284 12301 ...
 $ repub_pct_20  : num  71.4 76.2 53.5 78.4 89.6 ...
 $ dem_pct_20    : num  27.02 22.41 45.79 20.7 9.57 ...
 $ dem_support_20: Factor w/ 3 levels "low","medium",..: 1 1 1 1 1 3 1 1 1 1 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># And plot dem_support_20</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">ggplot</span>(elections, <span class="fu">aes</span>(<span class="at">x =</span> dem_support_20)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="example-3-change-labels-using-fct_recode" class="level3" data-number="16.4.3"><h3 data-number="16.4.3" class="anchored" data-anchor-id="example-3-change-labels-using-fct_recode">
<span class="header-section-number">16.4.3</span> Example 3: Change Labels using fct_recode</h3>
<p>We now have a factor variable, dem_support_20, with categories that are ordered in a meaningful way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">count</span>(dem_support_20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  dem_support_20    n
1            low 2494
2         medium  157
3           high  458</code></pre>
</div>
</div>
<p>But maybe we want to change up the category labels. For demo purposes, let’s create a new factor variable, results_20, that’s the same as dem_support_20 but with different category labels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># We can redefine any number of the category labels.</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co"># Here we'll relabel all 3 categories:</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>elections <span class="ot">&lt;-</span> elections <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">mutate</span>(<span class="at">results_20 =</span> <span class="fu">fct_recode</span>(dem_support_20, </span>
<span id="cb16-5"><a href="#cb16-5"></a>                                 <span class="st">"strong republican"</span> <span class="ot">=</span> <span class="st">"low"</span>,</span>
<span id="cb16-6"><a href="#cb16-6"></a>                                 <span class="st">"close race"</span> <span class="ot">=</span> <span class="st">"medium"</span>,</span>
<span id="cb16-7"><a href="#cb16-7"></a>                                 <span class="st">"strong democrat"</span> <span class="ot">=</span> <span class="st">"high"</span>))</span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co"># Check it out</span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="co"># Note that the new category labels are still in a meaningful,</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co"># not necessarily alphabetical, order!</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb16-13"><a href="#cb16-13"></a>  <span class="fu">count</span>(results_20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         results_20    n
1 strong republican 2494
2        close race  157
3   strong democrat  458</code></pre>
</div>
</div>
</section><section id="example-4-re-order-levels-using-fct_relevel" class="level3" data-number="16.4.4"><h3 data-number="16.4.4" class="anchored" data-anchor-id="example-4-re-order-levels-using-fct_relevel">
<span class="header-section-number">16.4.4</span> Example 4: Re-order Levels using fct_relevel</h3>
<p>Finally, let’s explore how the Republican vote varied from county to county within each state:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Note that we're just piping the data into ggplot instead of writing</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># it as the first argument</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> repub_pct_20, <span class="at">fill =</span> state_abbr)) <span class="sc">+</span> </span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Groups with fewer than two data points have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning
-Inf</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is too many density plots to put on top of one another. Let’s spread these out while keeping them in the same frame, hence easier to compare, using a joy plot or ridge plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb21-2"><a href="#cb21-2"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> repub_pct_20, <span class="at">y =</span> state_abbr, <span class="at">fill =</span> historical)) <span class="sc">+</span> </span>
<span id="cb21-4"><a href="#cb21-4"></a>    <span class="fu">geom_density_ridges</span>() <span class="sc">+</span> </span>
<span id="cb21-5"><a href="#cb21-5"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"purple"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 4.43</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>OK, but this is alphabetical. Suppose we want to reorder the states according to their typical Republican support. Recall that we did something similar in Example 2, using fct_relevel() to specify a meaningful order for the dem_support_20 categories:</p>
<pre><code>fct_relevel(dem_support_20, c("low", "medium", "high"))</code></pre>
<p>We could use fct_relevel() to reorder the states here, but what would be the drawbacks?</p>
<p><em>We would have to manually type out all 50 states in our desired order, which would be time-consuming and error-prone.</em></p>
</section><section id="example-5-re-order-levels-based-on-another-variable-using-fct_reorder" class="level3" data-number="16.4.5"><h3 data-number="16.4.5" class="anchored" data-anchor-id="example-5-re-order-levels-based-on-another-variable-using-fct_reorder">
<span class="header-section-number">16.4.5</span> Example 5: Re-order levels Based on Another Variable using fct_reorder</h3>
<p>When a meaningful order for the categories of a factor variable can be defined by another variable in our dataset, we can use fct_reorder(). In our joy plot, let’s reorder the states according to their median Republican support:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Since we might want states to be alphabetical in other parts of our analysis,</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co"># we'll pipe the data into the ggplot without storing it:</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">mutate</span>(<span class="at">state_abbr =</span> <span class="fu">fct_reorder</span>(state_abbr, repub_pct_20, <span class="at">.fun =</span> <span class="st">"median"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> repub_pct_20, <span class="at">y =</span> state_abbr, <span class="at">fill =</span> historical)) <span class="sc">+</span> </span>
<span id="cb24-6"><a href="#cb24-6"></a>    <span class="fu">geom_density_ridges</span>() <span class="sc">+</span> </span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"purple"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 4.43</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># How did the code change?</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="co"># And the corresponding output?</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">mutate</span>(<span class="at">state_abbr =</span> <span class="fu">fct_reorder</span>(state_abbr, repub_pct_20, <span class="at">.fun =</span> <span class="st">"median"</span>, <span class="at">.desc =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb26-5"><a href="#cb26-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> repub_pct_20, <span class="at">y =</span> state_abbr, <span class="at">fill =</span> historical)) <span class="sc">+</span> </span>
<span id="cb26-6"><a href="#cb26-6"></a>    <span class="fu">geom_density_ridges</span>() <span class="sc">+</span> </span>
<span id="cb26-7"><a href="#cb26-7"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"purple"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 4.43</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="summary" class="level3" data-number="16.4.6"><h3 data-number="16.4.6" class="anchored" data-anchor-id="summary">
<span class="header-section-number">16.4.6</span> Summary</h3>
<p>The forcats package, part of the tidyverse, includes handy functions for working with categorical variables (for + cats):</p>
<p>Here are just some, few of which we explored above:</p>
<ul>
<li>functions for changing the order of factor levels
<ul>
<li>fct_relevel() = manually reorder levels</li>
<li>fct_reorder() = reorder levels according to values of another variable</li>
<li>fct_infreq() = order levels from highest to lowest frequency</li>
<li>fct_rev() = reverse the current order</li>
</ul>
</li>
<li>functions for changing the labels or values of factor levels
<ul>
<li>fct_recode() = manually change levels</li>
<li>fct_lump() = group together least common levels</li>
</ul>
</li>
</ul></section></section><section id="exercises" class="level2" data-number="16.5"><h2 data-number="16.5" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">16.5</span> 12.3 Exercises</h2>
<p>The exercises revisit our grades data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Get rid of some duplicate rows!</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>grades <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://mac-stat.github.io/data/grades.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">distinct</span>(sid, sessionID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-4"><a href="#cb28-4"></a></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="co"># Check it out</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="fu">head</span>(grades)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     sid grade   sessionID
1 S31185    D+ session1784
2 S31185    B+ session1785
3 S31185    A- session1791
4 S31185    B+ session1792
5 S31185    B- session1794
6 S31185    C+ session1795</code></pre>
</div>
</div>
<p>We’ll explore the number of times each grade was assigned:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>grade_distribution <span class="ot">&lt;-</span> grades <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">count</span>(grade)</span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="fu">head</span>(grade_distribution)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  grade    n
1     A 1506
2    A- 1381
3    AU   27
4     B  804
5    B+ 1003
6    B-  330</code></pre>
</div>
</div>
<section id="exercise-1-changing-order" class="level3" data-number="16.5.1"><h3 data-number="16.5.1" class="anchored" data-anchor-id="exercise-1-changing-order">
<span class="header-section-number">16.5.1</span> Exercise 1: Changing Order</h3>
<p>Check out a column plot of the number of times each grade was assigned during the study period. This is similar to a bar plot, but where we define the height of a bar according to variable in our dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>grade_distribution <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> grade, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>    <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The order of the grades is goofy! Construct a new column plot, manually reordering the grades from high (A) to low (NC) with “S” and “AU” at the end:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>grade_distribution <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="fu">fct_relevel</span>(grade, <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"A-"</span>, <span class="st">"B+"</span>, <span class="st">"B"</span>, <span class="st">"B-"</span>, <span class="st">"C+"</span>, <span class="st">"C"</span>, <span class="st">"C-"</span>, <span class="st">"D+"</span>, <span class="st">"D"</span>, <span class="st">"D-"</span>, <span class="st">"NC"</span>, <span class="st">"S"</span>, <span class="st">"AU"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> grade, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>    <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Construct a new column plot, reordering the grades in ascending frequency (i.e.&nbsp;how often the grades were assigned):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>grade_distribution <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="fu">fct_reorder</span>(grade, n)) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> grade, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>    <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Construct a new column plot, reordering the grades in descending frequency (i.e.&nbsp;how often the grades were assigned):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>grade_distribution <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="fu">fct_reorder</span>(grade, n, <span class="at">.desc =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> grade, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>    <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="exercise-2-changing-factor-level-labels" class="level3" data-number="16.5.2"><h3 data-number="16.5.2" class="anchored" data-anchor-id="exercise-2-changing-factor-level-labels">
<span class="header-section-number">16.5.2</span> Exercise 2: Changing Factor Level Labels</h3>
<p>It may not be clear what “AU” and “S” stand for. Construct a new column plot that renames these levels “Audit” and “Satisfactory”, while keeping the other grade labels the same and in a meaningful order:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>grade_distribution <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="fu">fct_relevel</span>(grade, <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"A-"</span>, <span class="st">"B+"</span>, <span class="st">"B"</span>, <span class="st">"B-"</span>, <span class="st">"C+"</span>, <span class="st">"C"</span>, <span class="st">"C-"</span>, <span class="st">"D+"</span>, <span class="st">"D"</span>, <span class="st">"D-"</span>, <span class="st">"NC"</span>, <span class="st">"S"</span>, <span class="st">"AU"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="fu">fct_recode</span>(grade, <span class="st">"Satisfactory"</span> <span class="ot">=</span> <span class="st">"S"</span>, <span class="st">"Audit"</span> <span class="ot">=</span> <span class="st">"AU"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> grade, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5"></a>    <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="ica-working-with-factors_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../ica/ica-joining data.html" class="pagination-link" aria-label="Joining Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Joining Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../ica/ica-working with strings.html" class="pagination-link" aria-label="Working with Strings">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Working with Strings</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb37" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><a href="#cb37-1"></a><span class="co">---</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="an">title:</span><span class="co"> "Working with Factors"</span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="co">---</span></span>
<span id="cb37-5"><a href="#cb37-5"></a></span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="fu">## Learning Goals</span></span>
<span id="cb37-7"><a href="#cb37-7"></a></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="ss">-   </span>Understand the difference between character and factor variables.</span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="ss">-   </span>Be able to convert a character variable to a factor.</span>
<span id="cb37-10"><a href="#cb37-10"></a><span class="ss">-   </span>Develop comfort in manipulating the order and values of a factor.</span>
<span id="cb37-11"><a href="#cb37-11"></a></span>
<span id="cb37-12"><a href="#cb37-12"></a><span class="fu">## Additional Resources</span></span>
<span id="cb37-13"><a href="#cb37-13"></a></span>
<span id="cb37-14"><a href="#cb37-14"></a>For more information about the topics covered in this chapter, refer to the resources below:</span>
<span id="cb37-15"><a href="#cb37-15"></a></span>
<span id="cb37-16"><a href="#cb37-16"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">forcats cheat sheet (pdf)</span><span class="co">](https://raw.githubusercontent.com/rstudio/cheatsheets/master/factors.pdf)</span></span>
<span id="cb37-17"><a href="#cb37-17"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Factors (html)</span><span class="co">](https://r4ds.had.co.nz/factors.html)</span> by Wickham &amp; Grolemund</span>
<span id="cb37-18"><a href="#cb37-18"></a></span>
<span id="cb37-19"><a href="#cb37-19"></a><span class="fu">## 12.1 Review</span></span>
<span id="cb37-20"><a href="#cb37-20"></a></span>
<span id="cb37-21"><a href="#cb37-21"></a>Where are we? Data preparation</span>
<span id="cb37-22"><a href="#cb37-22"></a></span>
<span id="cb37-23"><a href="#cb37-23"></a>Thus far, we've learned how to:</span>
<span id="cb37-24"><a href="#cb37-24"></a></span>
<span id="cb37-25"><a href="#cb37-25"></a><span class="ss">-   </span>do some wrangling:</span>
<span id="cb37-26"><a href="#cb37-26"></a><span class="ss">    -   </span>arrange() our data in a meaningful order</span>
<span id="cb37-27"><a href="#cb37-27"></a><span class="ss">    -   </span>subset the data to only filter() the rows and select() the columns of interest</span>
<span id="cb37-28"><a href="#cb37-28"></a><span class="ss">    -   </span>mutate() existing variables and define new variables</span>
<span id="cb37-29"><a href="#cb37-29"></a><span class="ss">    -   </span>summarize() various aspects of a variable, both overall and by group (group_by())</span>
<span id="cb37-30"><a href="#cb37-30"></a><span class="ss">    -   </span>reshape our data to fit the task at hand (pivot_longer(), pivot_wider())</span>
<span id="cb37-31"><a href="#cb37-31"></a><span class="ss">    -   </span>join() different datasets into one</span>
<span id="cb37-32"><a href="#cb37-32"></a></span>
<span id="cb37-33"><a href="#cb37-33"></a><span class="fu">## 12.2 Factors</span></span>
<span id="cb37-34"><a href="#cb37-34"></a></span>
<span id="cb37-35"><a href="#cb37-35"></a>In the remaining days of our data preparation unit, we'll focus on working with special types of "categorical" variables: characters and factors. Variables with these structures often require special tools and considerations.</span>
<span id="cb37-36"><a href="#cb37-36"></a></span>
<span id="cb37-37"><a href="#cb37-37"></a>We'll focus on two common considerations:</span>
<span id="cb37-38"><a href="#cb37-38"></a></span>
<span id="cb37-39"><a href="#cb37-39"></a><span class="ss">1.  </span>**Regular expressions** When working with character strings, we might want to detect, replace, or extract certain patterns. For example, recall our data on courses:</span>
<span id="cb37-40"><a href="#cb37-40"></a></span>
<span id="cb37-41"><a href="#cb37-41"></a>    <span class="in">```         </span></span>
<span id="cb37-42"><a href="#cb37-42"></a><span class="in">        sessionID dept level    sem enroll     iid</span></span>
<span id="cb37-43"><a href="#cb37-43"></a><span class="in">    1 session1784    M   100 FA1991     22 inst265</span></span>
<span id="cb37-44"><a href="#cb37-44"></a><span class="in">    2 session1785    k   100 FA1991     52 inst458</span></span>
<span id="cb37-45"><a href="#cb37-45"></a><span class="in">    3 session1791    J   100 FA1993     22 inst223</span></span>
<span id="cb37-46"><a href="#cb37-46"></a><span class="in">    4 session1792    J   300 FA1993     20 inst235</span></span>
<span id="cb37-47"><a href="#cb37-47"></a><span class="in">    5 session1794    J   200 FA1993     22 inst234</span></span>
<span id="cb37-48"><a href="#cb37-48"></a><span class="in">    6 session1795    J   200 SP1994     26 inst230</span></span>
<span id="cb37-49"><a href="#cb37-49"></a><span class="in">    ```</span></span>
<span id="cb37-50"><a href="#cb37-50"></a></span>
<span id="cb37-51"><a href="#cb37-51"></a>    Focusing on just the sem character variable, we might want to…</span>
<span id="cb37-52"><a href="#cb37-52"></a></span>
<span id="cb37-53"><a href="#cb37-53"></a><span class="ss">    -   </span>change FA to fall<span class="sc">\_</span> and SP to spring<span class="sc">\_</span></span>
<span id="cb37-54"><a href="#cb37-54"></a><span class="ss">    -   </span>keep only courses taught in fall</span>
<span id="cb37-55"><a href="#cb37-55"></a><span class="ss">    -   </span>split the variable into 2 new variables: semester (FA or SP) and year</span>
<span id="cb37-56"><a href="#cb37-56"></a></span>
<span id="cb37-57"><a href="#cb37-57"></a><span class="ss">2.  </span>**Converting characters to factors (and factors to meaningful factors)** (today) When categorical information is stored as a character variable, the categories of interest might not be labeled or ordered in a meaningful way. We can fix that!</span>
<span id="cb37-58"><a href="#cb37-58"></a></span>
<span id="cb37-59"><a href="#cb37-59"></a><span class="fu">### Example 1: Default Order</span></span>
<span id="cb37-60"><a href="#cb37-60"></a></span>
<span id="cb37-61"><a href="#cb37-61"></a>Recall our data on presidential election outcomes in each U.S. county (except those in Alaska):</span>
<span id="cb37-62"><a href="#cb37-62"></a></span>
<span id="cb37-65"><a href="#cb37-65"></a><span class="in">```{r}</span></span>
<span id="cb37-66"><a href="#cb37-66"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb37-67"><a href="#cb37-67"></a>elections <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://mac-stat.github.io/data/election_2020_county.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-68"><a href="#cb37-68"></a>  <span class="fu">select</span>(state_abbr, historical, county_name, total_votes_20, repub_pct_20, dem_pct_20) <span class="sc">|&gt;</span> </span>
<span id="cb37-69"><a href="#cb37-69"></a>  <span class="fu">mutate</span>(<span class="at">dem_support_20 =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-70"><a href="#cb37-70"></a>    (repub_pct_20 <span class="sc">-</span> dem_pct_20 <span class="sc">&gt;=</span> <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"low"</span>,</span>
<span id="cb37-71"><a href="#cb37-71"></a>    (repub_pct_20 <span class="sc">-</span> dem_pct_20 <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">5</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb37-72"><a href="#cb37-72"></a>    <span class="at">.default =</span> <span class="st">"medium"</span></span>
<span id="cb37-73"><a href="#cb37-73"></a>  ))</span>
<span id="cb37-74"><a href="#cb37-74"></a></span>
<span id="cb37-75"><a href="#cb37-75"></a><span class="co"># Check it out</span></span>
<span id="cb37-76"><a href="#cb37-76"></a><span class="fu">head</span>(elections)  </span>
<span id="cb37-77"><a href="#cb37-77"></a><span class="in">```</span></span>
<span id="cb37-78"><a href="#cb37-78"></a></span>
<span id="cb37-79"><a href="#cb37-79"></a>Check out the below visual and numerical summaries of dem_support_20:</span>
<span id="cb37-80"><a href="#cb37-80"></a></span>
<span id="cb37-81"><a href="#cb37-81"></a><span class="ss">-   </span>low = the Republican won the county by at least 5 percentage points</span>
<span id="cb37-82"><a href="#cb37-82"></a><span class="ss">-   </span>medium = the Republican and Democrat votes were within 5 percentage points</span>
<span id="cb37-83"><a href="#cb37-83"></a><span class="ss">-   </span>high = the Democrat won the county by at least 5 percentage points</span>
<span id="cb37-84"><a href="#cb37-84"></a></span>
<span id="cb37-87"><a href="#cb37-87"></a><span class="in">```{r}</span></span>
<span id="cb37-88"><a href="#cb37-88"></a><span class="fu">ggplot</span>(elections, <span class="fu">aes</span>(<span class="at">x =</span> dem_support_20)) <span class="sc">+</span> </span>
<span id="cb37-89"><a href="#cb37-89"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb37-90"><a href="#cb37-90"></a><span class="in">```</span></span>
<span id="cb37-91"><a href="#cb37-91"></a></span>
<span id="cb37-94"><a href="#cb37-94"></a><span class="in">```{r}</span></span>
<span id="cb37-95"><a href="#cb37-95"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb37-96"><a href="#cb37-96"></a>  <span class="fu">count</span>(dem_support_20)</span>
<span id="cb37-97"><a href="#cb37-97"></a><span class="in">```</span></span>
<span id="cb37-98"><a href="#cb37-98"></a></span>
<span id="cb37-99"><a href="#cb37-99"></a>**Follow-up:**</span>
<span id="cb37-100"><a href="#cb37-100"></a></span>
<span id="cb37-101"><a href="#cb37-101"></a>What don't you like about these results?</span>
<span id="cb37-102"><a href="#cb37-102"></a></span>
<span id="cb37-103"><a href="#cb37-103"></a>*The categories are in alphabetical order (high, low, medium), which isn't particularly meaningful in this context. We would probably prefer them to be ordered by level of Democratic support (low, medium, high).*</span>
<span id="cb37-104"><a href="#cb37-104"></a></span>
<span id="cb37-105"><a href="#cb37-105"></a><span class="fu">### Example 2: Change Order using fct_relevel</span></span>
<span id="cb37-106"><a href="#cb37-106"></a></span>
<span id="cb37-107"><a href="#cb37-107"></a>The above categories of dem_support_20 are listed alphabetically, which isn't particularly meaningful here. This is because dem_support_20 is a character variable and R thinks of character strings as words, not category labels with any meaningful order (other than alphabetical):</span>
<span id="cb37-108"><a href="#cb37-108"></a></span>
<span id="cb37-111"><a href="#cb37-111"></a><span class="in">```{r}</span></span>
<span id="cb37-112"><a href="#cb37-112"></a><span class="fu">str</span>(elections)</span>
<span id="cb37-113"><a href="#cb37-113"></a><span class="in">```</span></span>
<span id="cb37-114"><a href="#cb37-114"></a></span>
<span id="cb37-115"><a href="#cb37-115"></a>We can fix this by using fct_relevel() to both:</span>
<span id="cb37-116"><a href="#cb37-116"></a></span>
<span id="cb37-117"><a href="#cb37-117"></a><span class="ss">1.  </span>Store dem_support_20 as a factor variable, the levels of which are recognized as specific levels or categories, not just words.</span>
<span id="cb37-118"><a href="#cb37-118"></a></span>
<span id="cb37-119"><a href="#cb37-119"></a><span class="ss">2.  </span>Specify a meaningful order for the levels of the factor variable.</span>
<span id="cb37-120"><a href="#cb37-120"></a></span>
<span id="cb37-123"><a href="#cb37-123"></a><span class="in">```{r}</span></span>
<span id="cb37-124"><a href="#cb37-124"></a><span class="co"># Notice that the order of the levels is not alphabetical!</span></span>
<span id="cb37-125"><a href="#cb37-125"></a>elections <span class="ot">&lt;-</span> elections <span class="sc">|&gt;</span> </span>
<span id="cb37-126"><a href="#cb37-126"></a>  <span class="fu">mutate</span>(<span class="at">dem_support_20 =</span> <span class="fu">fct_relevel</span>(dem_support_20, <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span>)))</span>
<span id="cb37-127"><a href="#cb37-127"></a></span>
<span id="cb37-128"><a href="#cb37-128"></a><span class="co"># Notice the new structure of the dem_support_20 variable</span></span>
<span id="cb37-129"><a href="#cb37-129"></a><span class="fu">str</span>(elections)</span>
<span id="cb37-130"><a href="#cb37-130"></a><span class="in">```</span></span>
<span id="cb37-131"><a href="#cb37-131"></a></span>
<span id="cb37-134"><a href="#cb37-134"></a><span class="in">```{r}</span></span>
<span id="cb37-135"><a href="#cb37-135"></a><span class="co"># And plot dem_support_20</span></span>
<span id="cb37-136"><a href="#cb37-136"></a><span class="fu">ggplot</span>(elections, <span class="fu">aes</span>(<span class="at">x =</span> dem_support_20)) <span class="sc">+</span></span>
<span id="cb37-137"><a href="#cb37-137"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb37-138"><a href="#cb37-138"></a><span class="in">```</span></span>
<span id="cb37-139"><a href="#cb37-139"></a></span>
<span id="cb37-140"><a href="#cb37-140"></a><span class="fu">### Example 3: Change Labels using fct_recode</span></span>
<span id="cb37-141"><a href="#cb37-141"></a></span>
<span id="cb37-142"><a href="#cb37-142"></a>We now have a factor variable, dem_support_20, with categories that are ordered in a meaningful way:</span>
<span id="cb37-143"><a href="#cb37-143"></a></span>
<span id="cb37-146"><a href="#cb37-146"></a><span class="in">```{r}</span></span>
<span id="cb37-147"><a href="#cb37-147"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb37-148"><a href="#cb37-148"></a>  <span class="fu">count</span>(dem_support_20)</span>
<span id="cb37-149"><a href="#cb37-149"></a><span class="in">```</span></span>
<span id="cb37-150"><a href="#cb37-150"></a></span>
<span id="cb37-151"><a href="#cb37-151"></a>But maybe we want to change up the category labels. For demo purposes, let's create a new factor variable, results_20, that's the same as dem_support_20 but with different category labels:</span>
<span id="cb37-152"><a href="#cb37-152"></a></span>
<span id="cb37-155"><a href="#cb37-155"></a><span class="in">```{r}</span></span>
<span id="cb37-156"><a href="#cb37-156"></a><span class="co"># We can redefine any number of the category labels.</span></span>
<span id="cb37-157"><a href="#cb37-157"></a><span class="co"># Here we'll relabel all 3 categories:</span></span>
<span id="cb37-158"><a href="#cb37-158"></a>elections <span class="ot">&lt;-</span> elections <span class="sc">|&gt;</span> </span>
<span id="cb37-159"><a href="#cb37-159"></a>  <span class="fu">mutate</span>(<span class="at">results_20 =</span> <span class="fu">fct_recode</span>(dem_support_20, </span>
<span id="cb37-160"><a href="#cb37-160"></a>                                 <span class="st">"strong republican"</span> <span class="ot">=</span> <span class="st">"low"</span>,</span>
<span id="cb37-161"><a href="#cb37-161"></a>                                 <span class="st">"close race"</span> <span class="ot">=</span> <span class="st">"medium"</span>,</span>
<span id="cb37-162"><a href="#cb37-162"></a>                                 <span class="st">"strong democrat"</span> <span class="ot">=</span> <span class="st">"high"</span>))</span>
<span id="cb37-163"><a href="#cb37-163"></a></span>
<span id="cb37-164"><a href="#cb37-164"></a><span class="co"># Check it out</span></span>
<span id="cb37-165"><a href="#cb37-165"></a><span class="co"># Note that the new category labels are still in a meaningful,</span></span>
<span id="cb37-166"><a href="#cb37-166"></a><span class="co"># not necessarily alphabetical, order!</span></span>
<span id="cb37-167"><a href="#cb37-167"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb37-168"><a href="#cb37-168"></a>  <span class="fu">count</span>(results_20)</span>
<span id="cb37-169"><a href="#cb37-169"></a><span class="in">```</span></span>
<span id="cb37-170"><a href="#cb37-170"></a></span>
<span id="cb37-171"><a href="#cb37-171"></a><span class="fu">### Example 4: Re-order Levels using fct_relevel</span></span>
<span id="cb37-172"><a href="#cb37-172"></a></span>
<span id="cb37-173"><a href="#cb37-173"></a>Finally, let's explore how the Republican vote varied from county to county within each state:</span>
<span id="cb37-174"><a href="#cb37-174"></a></span>
<span id="cb37-177"><a href="#cb37-177"></a><span class="in">```{r}</span></span>
<span id="cb37-178"><a href="#cb37-178"></a><span class="co"># Note that we're just piping the data into ggplot instead of writing</span></span>
<span id="cb37-179"><a href="#cb37-179"></a><span class="co"># it as the first argument</span></span>
<span id="cb37-180"><a href="#cb37-180"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb37-181"><a href="#cb37-181"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> repub_pct_20, <span class="at">fill =</span> state_abbr)) <span class="sc">+</span> </span>
<span id="cb37-182"><a href="#cb37-182"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb37-183"><a href="#cb37-183"></a><span class="in">```</span></span>
<span id="cb37-184"><a href="#cb37-184"></a></span>
<span id="cb37-185"><a href="#cb37-185"></a>This is too many density plots to put on top of one another. Let's spread these out while keeping them in the same frame, hence easier to compare, using a joy plot or ridge plot:</span>
<span id="cb37-186"><a href="#cb37-186"></a></span>
<span id="cb37-189"><a href="#cb37-189"></a><span class="in">```{r}</span></span>
<span id="cb37-190"><a href="#cb37-190"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb37-191"><a href="#cb37-191"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb37-192"><a href="#cb37-192"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> repub_pct_20, <span class="at">y =</span> state_abbr, <span class="at">fill =</span> historical)) <span class="sc">+</span> </span>
<span id="cb37-193"><a href="#cb37-193"></a>    <span class="fu">geom_density_ridges</span>() <span class="sc">+</span> </span>
<span id="cb37-194"><a href="#cb37-194"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"purple"</span>, <span class="st">"red"</span>))</span>
<span id="cb37-195"><a href="#cb37-195"></a><span class="in">```</span></span>
<span id="cb37-196"><a href="#cb37-196"></a></span>
<span id="cb37-197"><a href="#cb37-197"></a>OK, but this is alphabetical. Suppose we want to reorder the states according to their typical Republican support. Recall that we did something similar in Example 2, using fct_relevel() to specify a meaningful order for the dem_support_20 categories:</span>
<span id="cb37-198"><a href="#cb37-198"></a></span>
<span id="cb37-199"><a href="#cb37-199"></a><span class="in">```         </span></span>
<span id="cb37-200"><a href="#cb37-200"></a><span class="in">fct_relevel(dem_support_20, c("low", "medium", "high"))</span></span>
<span id="cb37-201"><a href="#cb37-201"></a><span class="in">```</span></span>
<span id="cb37-202"><a href="#cb37-202"></a></span>
<span id="cb37-203"><a href="#cb37-203"></a>We could use fct_relevel() to reorder the states here, but what would be the drawbacks?</span>
<span id="cb37-204"><a href="#cb37-204"></a></span>
<span id="cb37-205"><a href="#cb37-205"></a>*We would have to manually type out all 50 states in our desired order, which would be time-consuming and error-prone.*</span>
<span id="cb37-206"><a href="#cb37-206"></a></span>
<span id="cb37-207"><a href="#cb37-207"></a><span class="fu">### Example 5: Re-order levels Based on Another Variable using fct_reorder</span></span>
<span id="cb37-208"><a href="#cb37-208"></a></span>
<span id="cb37-209"><a href="#cb37-209"></a>When a meaningful order for the categories of a factor variable can be defined by another variable in our dataset, we can use fct_reorder(). In our joy plot, let's reorder the states according to their median Republican support:</span>
<span id="cb37-210"><a href="#cb37-210"></a></span>
<span id="cb37-213"><a href="#cb37-213"></a><span class="in">```{r}</span></span>
<span id="cb37-214"><a href="#cb37-214"></a><span class="co"># Since we might want states to be alphabetical in other parts of our analysis,</span></span>
<span id="cb37-215"><a href="#cb37-215"></a><span class="co"># we'll pipe the data into the ggplot without storing it:</span></span>
<span id="cb37-216"><a href="#cb37-216"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb37-217"><a href="#cb37-217"></a>  <span class="fu">mutate</span>(<span class="at">state_abbr =</span> <span class="fu">fct_reorder</span>(state_abbr, repub_pct_20, <span class="at">.fun =</span> <span class="st">"median"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb37-218"><a href="#cb37-218"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> repub_pct_20, <span class="at">y =</span> state_abbr, <span class="at">fill =</span> historical)) <span class="sc">+</span> </span>
<span id="cb37-219"><a href="#cb37-219"></a>    <span class="fu">geom_density_ridges</span>() <span class="sc">+</span> </span>
<span id="cb37-220"><a href="#cb37-220"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"purple"</span>, <span class="st">"red"</span>))</span>
<span id="cb37-221"><a href="#cb37-221"></a><span class="in">```</span></span>
<span id="cb37-222"><a href="#cb37-222"></a></span>
<span id="cb37-225"><a href="#cb37-225"></a><span class="in">```{r}</span></span>
<span id="cb37-226"><a href="#cb37-226"></a><span class="co"># How did the code change?</span></span>
<span id="cb37-227"><a href="#cb37-227"></a><span class="co"># And the corresponding output?</span></span>
<span id="cb37-228"><a href="#cb37-228"></a>elections <span class="sc">|&gt;</span> </span>
<span id="cb37-229"><a href="#cb37-229"></a>  <span class="fu">mutate</span>(<span class="at">state_abbr =</span> <span class="fu">fct_reorder</span>(state_abbr, repub_pct_20, <span class="at">.fun =</span> <span class="st">"median"</span>, <span class="at">.desc =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb37-230"><a href="#cb37-230"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> repub_pct_20, <span class="at">y =</span> state_abbr, <span class="at">fill =</span> historical)) <span class="sc">+</span> </span>
<span id="cb37-231"><a href="#cb37-231"></a>    <span class="fu">geom_density_ridges</span>() <span class="sc">+</span> </span>
<span id="cb37-232"><a href="#cb37-232"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"purple"</span>, <span class="st">"red"</span>))</span>
<span id="cb37-233"><a href="#cb37-233"></a><span class="in">```</span></span>
<span id="cb37-234"><a href="#cb37-234"></a></span>
<span id="cb37-235"><a href="#cb37-235"></a><span class="fu">### Summary</span></span>
<span id="cb37-236"><a href="#cb37-236"></a></span>
<span id="cb37-237"><a href="#cb37-237"></a>The forcats package, part of the tidyverse, includes handy functions for working with categorical variables (for + cats):</span>
<span id="cb37-238"><a href="#cb37-238"></a></span>
<span id="cb37-239"><a href="#cb37-239"></a>Here are just some, few of which we explored above:</span>
<span id="cb37-240"><a href="#cb37-240"></a></span>
<span id="cb37-241"><a href="#cb37-241"></a><span class="ss">-   </span>functions for changing the order of factor levels</span>
<span id="cb37-242"><a href="#cb37-242"></a><span class="ss">    -   </span>fct_relevel() = manually reorder levels</span>
<span id="cb37-243"><a href="#cb37-243"></a><span class="ss">    -   </span>fct_reorder() = reorder levels according to values of another variable</span>
<span id="cb37-244"><a href="#cb37-244"></a><span class="ss">    -   </span>fct_infreq() = order levels from highest to lowest frequency</span>
<span id="cb37-245"><a href="#cb37-245"></a><span class="ss">    -   </span>fct_rev() = reverse the current order</span>
<span id="cb37-246"><a href="#cb37-246"></a><span class="ss">-   </span>functions for changing the labels or values of factor levels</span>
<span id="cb37-247"><a href="#cb37-247"></a><span class="ss">    -   </span>fct_recode() = manually change levels</span>
<span id="cb37-248"><a href="#cb37-248"></a><span class="ss">    -   </span>fct_lump() = group together least common levels</span>
<span id="cb37-249"><a href="#cb37-249"></a></span>
<span id="cb37-250"><a href="#cb37-250"></a><span class="fu">## 12.3 Exercises</span></span>
<span id="cb37-251"><a href="#cb37-251"></a></span>
<span id="cb37-252"><a href="#cb37-252"></a>The exercises revisit our grades data:</span>
<span id="cb37-253"><a href="#cb37-253"></a></span>
<span id="cb37-256"><a href="#cb37-256"></a><span class="in">```{r}</span></span>
<span id="cb37-257"><a href="#cb37-257"></a><span class="co"># Get rid of some duplicate rows!</span></span>
<span id="cb37-258"><a href="#cb37-258"></a>grades <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://mac-stat.github.io/data/grades.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-259"><a href="#cb37-259"></a>  <span class="fu">distinct</span>(sid, sessionID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-260"><a href="#cb37-260"></a></span>
<span id="cb37-261"><a href="#cb37-261"></a><span class="co"># Check it out</span></span>
<span id="cb37-262"><a href="#cb37-262"></a><span class="fu">head</span>(grades)</span>
<span id="cb37-263"><a href="#cb37-263"></a><span class="in">```</span></span>
<span id="cb37-264"><a href="#cb37-264"></a></span>
<span id="cb37-265"><a href="#cb37-265"></a>We'll explore the number of times each grade was assigned:</span>
<span id="cb37-266"><a href="#cb37-266"></a></span>
<span id="cb37-269"><a href="#cb37-269"></a><span class="in">```{r}</span></span>
<span id="cb37-270"><a href="#cb37-270"></a>grade_distribution <span class="ot">&lt;-</span> grades <span class="sc">|&gt;</span> </span>
<span id="cb37-271"><a href="#cb37-271"></a>  <span class="fu">count</span>(grade)</span>
<span id="cb37-272"><a href="#cb37-272"></a></span>
<span id="cb37-273"><a href="#cb37-273"></a><span class="fu">head</span>(grade_distribution)</span>
<span id="cb37-274"><a href="#cb37-274"></a><span class="in">```</span></span>
<span id="cb37-275"><a href="#cb37-275"></a></span>
<span id="cb37-276"><a href="#cb37-276"></a><span class="fu">### Exercise 1: Changing Order</span></span>
<span id="cb37-277"><a href="#cb37-277"></a></span>
<span id="cb37-278"><a href="#cb37-278"></a>Check out a column plot of the number of times each grade was assigned during the study period. This is similar to a bar plot, but where we define the height of a bar according to variable in our dataset.</span>
<span id="cb37-279"><a href="#cb37-279"></a></span>
<span id="cb37-282"><a href="#cb37-282"></a><span class="in">```{r}</span></span>
<span id="cb37-283"><a href="#cb37-283"></a>grade_distribution <span class="sc">|&gt;</span> </span>
<span id="cb37-284"><a href="#cb37-284"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> grade, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb37-285"><a href="#cb37-285"></a>    <span class="fu">geom_col</span>()</span>
<span id="cb37-286"><a href="#cb37-286"></a><span class="in">```</span></span>
<span id="cb37-287"><a href="#cb37-287"></a></span>
<span id="cb37-288"><a href="#cb37-288"></a>The order of the grades is goofy! Construct a new column plot, manually reordering the grades from high (A) to low (NC) with "S" and "AU" at the end:</span>
<span id="cb37-289"><a href="#cb37-289"></a></span>
<span id="cb37-292"><a href="#cb37-292"></a><span class="in">```{r}</span></span>
<span id="cb37-293"><a href="#cb37-293"></a>grade_distribution <span class="sc">|&gt;</span></span>
<span id="cb37-294"><a href="#cb37-294"></a>  <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="fu">fct_relevel</span>(grade, <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"A-"</span>, <span class="st">"B+"</span>, <span class="st">"B"</span>, <span class="st">"B-"</span>, <span class="st">"C+"</span>, <span class="st">"C"</span>, <span class="st">"C-"</span>, <span class="st">"D+"</span>, <span class="st">"D"</span>, <span class="st">"D-"</span>, <span class="st">"NC"</span>, <span class="st">"S"</span>, <span class="st">"AU"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb37-295"><a href="#cb37-295"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> grade, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb37-296"><a href="#cb37-296"></a>    <span class="fu">geom_col</span>()</span>
<span id="cb37-297"><a href="#cb37-297"></a><span class="in">```</span></span>
<span id="cb37-298"><a href="#cb37-298"></a></span>
<span id="cb37-299"><a href="#cb37-299"></a>Construct a new column plot, reordering the grades in ascending frequency (i.e. how often the grades were assigned):</span>
<span id="cb37-300"><a href="#cb37-300"></a></span>
<span id="cb37-303"><a href="#cb37-303"></a><span class="in">```{r}</span></span>
<span id="cb37-304"><a href="#cb37-304"></a>grade_distribution <span class="sc">|&gt;</span></span>
<span id="cb37-305"><a href="#cb37-305"></a>  <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="fu">fct_reorder</span>(grade, n)) <span class="sc">|&gt;</span></span>
<span id="cb37-306"><a href="#cb37-306"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> grade, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb37-307"><a href="#cb37-307"></a>    <span class="fu">geom_col</span>()</span>
<span id="cb37-308"><a href="#cb37-308"></a><span class="in">```</span></span>
<span id="cb37-309"><a href="#cb37-309"></a></span>
<span id="cb37-310"><a href="#cb37-310"></a>Construct a new column plot, reordering the grades in descending frequency (i.e. how often the grades were assigned):</span>
<span id="cb37-311"><a href="#cb37-311"></a></span>
<span id="cb37-314"><a href="#cb37-314"></a><span class="in">```{r}</span></span>
<span id="cb37-315"><a href="#cb37-315"></a>grade_distribution <span class="sc">|&gt;</span></span>
<span id="cb37-316"><a href="#cb37-316"></a>  <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="fu">fct_reorder</span>(grade, n, <span class="at">.desc =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb37-317"><a href="#cb37-317"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> grade, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb37-318"><a href="#cb37-318"></a>    <span class="fu">geom_col</span>()</span>
<span id="cb37-319"><a href="#cb37-319"></a><span class="in">```</span></span>
<span id="cb37-320"><a href="#cb37-320"></a></span>
<span id="cb37-321"><a href="#cb37-321"></a><span class="fu">### Exercise 2: Changing Factor Level Labels</span></span>
<span id="cb37-322"><a href="#cb37-322"></a></span>
<span id="cb37-323"><a href="#cb37-323"></a>It may not be clear what "AU" and "S" stand for. Construct a new column plot that renames these levels "Audit" and "Satisfactory", while keeping the other grade labels the same and in a meaningful order:</span>
<span id="cb37-324"><a href="#cb37-324"></a></span>
<span id="cb37-327"><a href="#cb37-327"></a><span class="in">```{r}</span></span>
<span id="cb37-328"><a href="#cb37-328"></a>grade_distribution <span class="sc">|&gt;</span></span>
<span id="cb37-329"><a href="#cb37-329"></a>  <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="fu">fct_relevel</span>(grade, <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"A-"</span>, <span class="st">"B+"</span>, <span class="st">"B"</span>, <span class="st">"B-"</span>, <span class="st">"C+"</span>, <span class="st">"C"</span>, <span class="st">"C-"</span>, <span class="st">"D+"</span>, <span class="st">"D"</span>, <span class="st">"D-"</span>, <span class="st">"NC"</span>, <span class="st">"S"</span>, <span class="st">"AU"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb37-330"><a href="#cb37-330"></a>  <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="fu">fct_recode</span>(grade, <span class="st">"Satisfactory"</span> <span class="ot">=</span> <span class="st">"S"</span>, <span class="st">"Audit"</span> <span class="ot">=</span> <span class="st">"AU"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb37-331"><a href="#cb37-331"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> grade, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb37-332"><a href="#cb37-332"></a>    <span class="fu">geom_col</span>()</span>
<span id="cb37-333"><a href="#cb37-333"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>